import{a as Kl}from"https://app.framerstatic.com/chunk-6TPOUQMA.mjs";import"https://app.framerstatic.com/chunk-7XU4G6VA.mjs";import{a as it}from"https://app.framerstatic.com/chunk-O7HV4KEE.mjs";import{a as jl}from"https://app.framerstatic.com/chunk-MTVPXQIM.mjs";import{a as yr,b as _l,c as ql}from"https://app.framerstatic.com/chunk-SHIZTMNC.mjs";import"https://app.framerstatic.com/chunk-M6NUOYZT.mjs";import"https://app.framerstatic.com/chunk-FN72U4K2.mjs";import{$b as gn,Ad as Hl,B as mr,Bb as ol,Da as un,Dc as wo,Eb as rl,Ec as vl,Hc as hn,Ib as k,Ic as bl,Jb as St,K as pn,Kb as T,Lb as nl,Mb as il,Oc as Co,Rc as In,Tc as Sl,Uc as El,Wb as pl,Xc as $t,Za as Js,Zc as Tl,_a as Qs,_b as ul,a as sr,ac as gl,b as Ls,bc as yl,bd as Nl,c as zs,cc as hl,dc as yn,e as Ws,fb as el,fd as Al,g as Hs,gd as Dl,h as js,hd as Bl,jd as Rl,kd as kl,ld as Ol,m as lr,n as _s,o as cr,oc as Il,od as Ml,pc as Ul,pd as Vl,q as dr,qc as wl,qd as ur,r as fr,rc as xl,rd as gr,s as qs,sc as Fl,tc as Pl,u as Ks,ud as K,w as Gs,wd as Ll,x as Ys,xb as tl,xd as zl,y as $s,zd as Wl}from"https://app.framerstatic.com/chunk-6I35AZOX.mjs";import"https://app.framerstatic.com/chunk-VX6GHWJ7.mjs";import{a as nt,c as ll,e as cl,f as dl}from"https://app.framerstatic.com/chunk-ZQW4FAPS.mjs";import{h as Vs}from"https://app.framerstatic.com/chunk-FANSRDYG.mjs";import{J as Es,K as Uo}from"https://app.framerstatic.com/chunk-M56TSXNO.mjs";import"https://app.framerstatic.com/chunk-S2XNK77Q.mjs";import"https://app.framerstatic.com/chunk-IHOAENGB.mjs";import{$ as nr,Aa as hs,G as es,H as ts,I as as,La as Is,R as vt,S as bt,Ta as Fs,U as H,X as ss,Y as ds,Z as fs,_ as rr,aa as ms,ba as ps,ca as us,da as Gt,fa as ir,ga as ar,jb as vs,kb as Ns,sa as ys}from"https://app.framerstatic.com/chunk-7HHNHA26.mjs";import{H as bs,I as Ss,K as Ts,N as As,k as Cs,m as xs}from"https://app.framerstatic.com/chunk-KE43BUTG.mjs";import{xa as gs}from"https://app.framerstatic.com/chunk-LKYQN6CK.mjs";import{$e as or,Le as er,We as ns,Ye as is,Ze as tr,ba as Ca,ea as xa,fa as F,fd as Qa,ga as Fa,mc as Zo,oc as Ja,ue as rs}from"https://app.framerstatic.com/chunk-QK7RZANV.mjs";import{f as os}from"https://app.framerstatic.com/chunk-NHTNRUDC.mjs";import"https://app.framerstatic.com/chunk-TMAQ5MRE.mjs";import"https://app.framerstatic.com/chunk-EDICM4ZE.mjs";import"https://app.framerstatic.com/chunk-MTT6DWBN.mjs";import"https://app.framerstatic.com/chunk-5C7X4FEK.mjs";import"https://app.framerstatic.com/chunk-Z2EPYIAC.mjs";import"https://app.framerstatic.com/chunk-N57XNHE3.mjs";import"https://app.framerstatic.com/chunk-OJKKDP2L.mjs";import"https://app.framerstatic.com/chunk-AECGRAPL.mjs";import"https://app.framerstatic.com/chunk-SE354WOV.mjs";import{i as ls,j as cs}from"https://app.framerstatic.com/chunk-YE4QPCYK.mjs";import"https://app.framerstatic.com/chunk-UYMPKBFU.mjs";import{c as Cl}from"https://app.framerstatic.com/chunk-MWKCVHIZ.mjs";import"https://app.framerstatic.com/chunk-Z5QQF73H.mjs";import"https://app.framerstatic.com/chunk-ZSAYZXBL.mjs";import"https://app.framerstatic.com/chunk-3MPIGKMW.mjs";import"https://app.framerstatic.com/chunk-X5UQIU2V.mjs";import"https://app.framerstatic.com/chunk-YE25YANI.mjs";import"https://app.framerstatic.com/chunk-S5WIMRPN.mjs";import"https://app.framerstatic.com/chunk-5QIPMXY3.mjs";import{a as Yt}from"https://app.framerstatic.com/chunk-PB5A2XGI.mjs";import"https://app.framerstatic.com/chunk-EWEZCJKH.mjs";import"https://app.framerstatic.com/chunk-Q4ZQNAWB.mjs";import{a as Ms}from"https://app.framerstatic.com/chunk-X7PME7OH.mjs";import{a as Xa,b as ut}from"https://app.framerstatic.com/chunk-V5DLHKAM.mjs";import{b as Zs}from"https://app.framerstatic.com/chunk-BXUHKYBF.mjs";import"https://app.framerstatic.com/chunk-D7MEQ7Y3.mjs";import"https://app.framerstatic.com/chunk-E6LXWDTM.mjs";import"https://app.framerstatic.com/chunk-IBD76ZDY.mjs";import"https://app.framerstatic.com/chunk-FJ3VJUIB.mjs";import{j as Za}from"https://app.framerstatic.com/chunk-G3FMRAP6.mjs";import"https://app.framerstatic.com/chunk-VNUA34VW.mjs";import"https://app.framerstatic.com/chunk-YS3B4HMG.mjs";import{a as fl,d as ml}from"https://app.framerstatic.com/chunk-SUQKKYQM.mjs";import"https://app.framerstatic.com/chunk-XIQEQHO4.mjs";import"https://app.framerstatic.com/chunk-IEVL5MAG.mjs";import"https://app.framerstatic.com/chunk-E7MDVJLG.mjs";import"https://app.framerstatic.com/chunk-ABHKVANM.mjs";import{a as Xs}from"https://app.framerstatic.com/chunk-5LBBN5VN.mjs";import{a as Os}from"https://app.framerstatic.com/chunk-DLZI2LJX.mjs";import{a as sl}from"https://app.framerstatic.com/chunk-ZZED43O6.mjs";import{d as ws,e as Ps}from"https://app.framerstatic.com/chunk-WAEDXNPB.mjs";import{a as Us}from"https://app.framerstatic.com/chunk-QQGFXN3A.mjs";import{g as Pt,j as Jo,m as Qo,n as rt,u as fe}from"https://app.framerstatic.com/chunk-ITQJBEMK.mjs";import"https://app.framerstatic.com/chunk-5Q3JIVQX.mjs";import{$c as Ft,$d as ga,Bc as xt,Bg as Yo,Cg as Ua,Jd as fn,Ka as Go,Kd as mn,Qg as wa,Tb as da,ae as ya,bc as fa,be as ha,ce as Ia,la as cn,td as pa,ud as ua}from"https://app.framerstatic.com/chunk-YHHLDGNJ.mjs";import"https://app.framerstatic.com/chunk-2YBI3QOI.mjs";import{e as ma,f as Me}from"https://app.framerstatic.com/chunk-WA7V4JHN.mjs";import"https://app.framerstatic.com/chunk-Y4KSD2WZ.mjs";import"https://app.framerstatic.com/chunk-QFWDP3IY.mjs";import{d as al}from"https://app.framerstatic.com/chunk-7HM7BFR2.mjs";import"https://app.framerstatic.com/chunk-YOFBDBTL.mjs";import"https://app.framerstatic.com/chunk-6GUIIDJM.mjs";import{$e as Va,Cg as Ga,Dg as Ya,Ee as ka,Fe as Ne,If as Ha,J as Ta,Jf as ja,Le as Y,Of as _t,Pf as qt,Re as ot,Rf as Kt,S as Na,Sg as $a,Tf as Xo,Vc as Ba,We as Oa,Ze as Ma,b as ba,bg as _a,h as Sa,hf as $o,lb as Aa,lf as La,m as Ea,mf as za,of as Wa,ub as Da,xg as qa,ye as Ra,yg as Ka}from"https://app.framerstatic.com/chunk-TZIRDX3J.mjs";import"https://app.framerstatic.com/chunk-4JI2Z3EJ.mjs";import"https://app.framerstatic.com/chunk-NITQ6GUY.mjs";import"https://app.framerstatic.com/chunk-OOKYJP4H.mjs";import"https://app.framerstatic.com/chunk-LMZJ2VTF.mjs";import{a as pr}from"https://app.framerstatic.com/chunk-RDEZD42O.mjs";import{a as Bs}from"https://app.framerstatic.com/chunk-2HN74DO4.mjs";import{a as J}from"https://app.framerstatic.com/chunk-QFU6OGL3.mjs";import{a as Ds,b as Rs,c as ks}from"https://app.framerstatic.com/chunk-CTKJD4ES.mjs";import"https://app.framerstatic.com/chunk-KCXVAIK2.mjs";import{Re as Ko,kc as Oe,o as ia,p as aa,qd as ca,wb as sa,xf as dn}from"https://app.framerstatic.com/chunk-6US6DZT3.mjs";import{Ap as an,Ar as jt,B as le,El as Ht,Gb as Vi,Hb as Li,I as Re,Ib as W,Ip as Ji,Jc as tn,Jp as Qi,Me as yo,Ne as ji,Nq as sn,Oq as ea,Pe as on,Te as _i,Tn as ce,Xl as nn,Xn as Lo,Xq as ln,Yf as qi,Zd as Wi,Ze as A,Zf as Ki,Zj as Yi,_e as ke,aj as rn,au as Io,bf as zt,bo as $i,bt as pt,cf as Xe,cg as Wt,cp as Zi,ct as na,dt as zo,ft as Wo,ga as ge,hb as ki,he as ko,jb as Oi,l as S,nc as zi,nj as Oo,pc as Ro,qb as Mi,qr as oa,rj as Gi,rk as Mo,rt as Ho,st as jo,tk as ho,tt as _o,ue as Hi,ut as qo,vc as We,xw as la,yk as Vo,yo as Xi}from"https://app.framerstatic.com/chunk-A3XCEWME.mjs";import"https://app.framerstatic.com/chunk-VXJAAVJQ.mjs";import{e as ra}from"https://app.framerstatic.com/chunk-6C6VSETA.mjs";import"https://app.framerstatic.com/chunk-FYUJQV6J.mjs";import"https://app.framerstatic.com/chunk-KYPY4QS7.mjs";import"https://app.framerstatic.com/chunk-ZM2TCRVZ.mjs";import"https://app.framerstatic.com/chunk-R3NZHMAQ.mjs";import{K as ft,n as Ni,x as Ai,y as Di}from"https://app.framerstatic.com/chunk-UZ3C6GS3.mjs";import{a as ta,b as q}from"https://app.framerstatic.com/chunk-GO7WVIKP.mjs";import"https://app.framerstatic.com/chunk-XFC6OVIX.mjs";import"https://app.framerstatic.com/chunk-4I3XDWXC.mjs";import{a as V,b as Ei}from"https://app.framerstatic.com/chunk-4AQCMAAQ.mjs";import"https://app.framerstatic.com/chunk-D76S3G46.mjs";import{a as gt}from"https://app.framerstatic.com/chunk-7GSEC7H4.mjs";import"https://app.framerstatic.com/chunk-45VVC36H.mjs";import{c as Ti}from"https://app.framerstatic.com/chunk-3UVLKWUZ.mjs";import"https://app.framerstatic.com/chunk-POQKH4YA.mjs";import{e as Pa,g as va,i as Ue}from"https://app.framerstatic.com/chunk-2E2TF6K3.mjs";import"https://app.framerstatic.com/chunk-AUNF3KWQ.mjs";import{p as Ie,r as Lt}from"https://app.framerstatic.com/chunk-W5VAAB5H.mjs";import"https://app.framerstatic.com/chunk-JFRKIM2Y.mjs";import{b as _,d as go,e as mt,f as Bo,i as Te,m as en,o as Ri}from"https://app.framerstatic.com/chunk-ZQUNXESX.mjs";import{Bc as Bi,a as ie,ad as $e,b as I}from"https://app.framerstatic.com/chunk-NIDOI5EE.mjs";import"https://app.framerstatic.com/chunk-SALNC65Q.mjs";import{f as Si}from"https://app.framerstatic.com/chunk-ALLJ3UV4.mjs";import{F as bi,da as uo,ea as Vt,i as No,l as de,p as Ao}from"https://app.framerstatic.com/chunk-7J5JFG4S.mjs";import{a as m,b as po}from"https://app.framerstatic.com/chunk-WNSBRACC.mjs";import{a as Do}from"https://app.framerstatic.com/chunk-LQILWJHN.mjs";import{e as y,f as ae,g as se,h as C,i as N,j as h,k as Mt,l as R,m as To}from"https://app.framerstatic.com/chunk-AHQIRSXG.mjs";var Yl=y(I()),Zf={BooleanControlPropRow:yr,EnumControlPropRow:wo,StringControlPropRow:Co};function Gl({children:r}){return(0,Yl.jsx)(ol.Provider,{value:Zf,children:r})}var Un="data-chrome";function $l(r){return r instanceof HTMLElement?r.closest(`[${Un}]`)!==null:!1}var wn="data-floating-canvas-chrome";function Xl(r){return r instanceof Element?r.closest(`[${wn}]`)!==null:!1}function Zl(){return window}function Cn(){return Zl().secureFrameAncestors}function Xt(){V(Cn(),"Must have secure frame ancestors.")}var Br=y(ie());var Jl="c1gxt05z",Ql="n1sd5akc";var Et=y(ie());var xn=y(I());function ec({collectionItemNode:r,collectionNode:o,controlProp:e,variableId:t,warningMessage:n,onChange:i}){let a=q(),l=o.getPropertyControls(a.tree,S)[t];return V(l?.type==="boolean"),(0,xn.jsx)(K,{title:l.title??"",warningMessage:n,children:(0,xn.jsx)(Tl,{control:l,controlProp:e,fieldId:t,itemId:r.id,onChange:d=>{fe(d)&&i(t,d)}})})}var tc="o1kosemn",oc="o1tcokht",rc="o11jr4ka",Qf=1,nc=Ue.panelPadding+Qf,ic="oaqx903",hr="b1gqim6f";var ac="wje69dc",sc="i1rqgchl",lc="ixghur2",cc="c1d0unc6";var Fn=y(I());function dc({collectionNode:r,controlProp:o,variableId:e,warningMessage:t,onChange:n}){let i=q(),s=r.getPropertyControls(i.tree,S)[e];V(s?.type==="collectionreference");let l=Ji(s,o);V(!W(l),"Variables are not supported");let d=s.dataIdentifier;function u(g){n(e,{type:"collectionreference",value:g})}return(0,Fn.jsx)(K,{title:s.title??"",warningMessage:t,children:(0,Fn.jsx)(pl,{large:!0,value:l,onChange:u,className:sc,dataIdentifier:d,wrapperClassName:ki(ac,cc),iconClassName:lc})})}var Pn=y(I());function fc({collectionItemNode:r,collectionNode:o,controlProp:e,variableId:t,warningMessage:n,onChange:i}){let a=q(),l=o.getPropertyControls(a.tree,S)[t];return V(l?.type==="color"),(0,Pn.jsx)(K,{title:l.title??"",warningMessage:n,children:(0,Pn.jsx)(Al,{control:l,controlProp:e,fieldId:t,itemId:r.id,onChange:d=>{fe(d)&&i(t,d)},ColorPickerPopoutComponent:tl})})}var vn=y(I());function mc({collectionItemNode:r,collectionNode:o,controlProp:e,variableId:t,warningMessage:n,onChange:i}){let a=q(),l=o.getPropertyControls(a.tree,S)[t];return V(l?.type==="date"),(0,vn.jsx)(K,{title:l.title??"",warningMessage:n,children:(0,vn.jsx)(Dl,{control:l,controlProp:e,fieldId:t,itemId:r.id,onChange:d=>{fe(d)&&i(t,d)},required:!1})})}var bn=y(I());function pc({collectionItemNode:r,collectionNode:o,controlProp:e,variableId:t,warningMessage:n,onChange:i}){let a=q(),l=o.getPropertyControls(a.tree,S)[t];return V(l?.type==="enum"),(0,bn.jsx)(K,{title:l.title??"",warningMessage:n,children:(0,bn.jsx)(Bl,{control:l,controlProp:e,fieldId:t,itemId:r.id,onChange:d=>{fe(d)&&i(t,d)}})})}var Sn=y(I());function uc({collectionItemNode:r,collectionNode:o,controlProp:e,variableId:t,warningMessage:n,onChange:i}){let a=q(),l=o.getPropertyControls(a.tree,S)[t];if(V(l?.type==="file"),V(!We(e?.value),"Dynamic values are not supported within required field validation"),e&&e?.type!=="file")return null;let u=(e?.value??"").split(".").pop(),g=!u||l.allowedFileTypes.length===0||l.allowedFileTypes.includes(u);return(0,Sn.jsx)(K,{title:l.title??"",warningMessage:n,showWarningTint:!g,children:(0,Sn.jsx)(Rl,{control:l,controlProp:e,fieldId:t,itemId:r.id,onChange:U=>{fe(U)&&i(t,U)},reset:()=>{i(t,{type:"file",value:void 0})}})})}var En=y(I());function gc({collectionItemNode:r,collectionNode:o,controlProp:e,variableId:t,onChange:n}){let i=q(),a=Ms(c=>{let f=c(e);f&&n(t,f)}),l=o.getPropertyControls(i.tree,S)[t];V(l?.type==="array"),V(!e||Yi(e));let d=qs(e,l,!0),u=Ks(e,l,!0),U=fr(d??u,l);return(0,En.jsx)(K,{title:l.title??"",warningMessage:U,children:(0,En.jsx)(kl,{collectionId:o.id,control:l,fieldId:t,controlProp:e,itemId:r.id,onChange:a,required:!1})})}var Tn=y(I());function yc({collectionItemNode:r,collectionNode:o,controlProp:e,variableId:t,warningMessage:n,onChange:i}){let a=q(),l=o.getPropertyControls(a.tree,S)[t];return V(l?.type==="responsiveimage"),(0,Tn.jsx)(K,{title:l.title??"",warningMessage:n,children:(0,Tn.jsx)(Ol,{control:l,controlProp:e,fieldId:t,itemId:r.id,onChange:d=>{let u=d(e);fe(u)&&i(t,u)},reset:()=>{let d={type:"image",value:void 0};i(t,d)}})})}var Nn=y(I());function hc({collectionItemNode:r,collectionNode:o,controlProp:e,variableId:t,warningMessage:n,onChange:i}){let a=q(),l=o.getPropertyControls(a.tree,S)[t];return V(l?.type==="link"),(0,Nn.jsx)(K,{title:l.title??"",warningMessage:n,children:(0,Nn.jsx)(Ml,{control:l,controlProp:e,fieldId:t,itemId:r.id,onChange:d=>{fe(d)&&i(t,d)},reset:()=>{let d={type:"link",value:void 0};i(t,d)}})})}var Ic="i4uywus";var An=y(I());function Uc({collectionNode:r,controlProp:o,variableId:e,warningMessage:t,onChange:n}){let i=q(),s=r.getPropertyControls(i.tree,S)[e];m(s?.type==="multicollectionreference");let l=s.dataIdentifier,d=Qi(s,o)??[];return m(!W(d),"Variables are not supported"),(0,An.jsx)(K,{title:s.title??"",warningMessage:t,children:(0,An.jsx)(bl,{large:!0,value:d,onChange:u=>{n(e,{type:"multicollectionreference",value:u})},wrapperClassName:Ic,dataIdentifier:l})})}var Dn=y(I());function wc({collectionItemNode:r,collectionNode:o,controlProp:e,variableId:t,warningMessage:n,onChange:i}){let a=q(),l=o.getPropertyControls(a.tree,S)[t];return V(l?.type==="number"),(0,Dn.jsx)(K,{title:l.title??"",warningMessage:n,children:(0,Dn.jsx)(Vl,{control:l,controlProp:e,fieldId:t,itemId:r.id,onChange:d=>{fe(d)&&i(t,d)}})})}var Ir=y(I()),Cc=["left","right","auto-vertical"];function xc({collectionNode:r,collectionItemNode:o,controlProp:e,variableId:t,onChange:n,warningMessage:i}){let a=q(),l=r.getPropertyControls(a.tree,S)[t];m(l?.type==="richtext");let d=e&&Ti(e.value)?e.value:void 0,u=c=>{n(t,{type:l.type,value:c})},g=pr(()=>pt(Wo)),U=Lt("pasteMarkdown");return(0,Ir.jsx)(K,{title:l.title??"",warningMessage:i,children:U?(0,Ir.jsx)(ur,{enabled:!0,schema:g,compactTagSelector:!0,defaultValue:d??"",onChange:u,scopeType:"ContentManagement",onUnsavedChange:gt,popoverAttachmentEdge:Cc,fallbackToModalAppearance:!0,saveOnMetaArrowNavigation:!0},o.id):(0,Ir.jsx)(gr,{enabled:!0,supportsEmbeds:!0,supportsMedia:!0,compactTagSelector:!0,defaultValue:d??"",onChange:u,scopeType:"ContentManagement",onUnsavedChange:gt,popoverAttachmentEdge:Cc,fallbackToModalAppearance:!0,saveOnMetaArrowNavigation:!0},o.id)})}var Ur=y(I());function Fc({collectionNode:r,collectionItemNode:o,controlProp:e,variableId:t,onChange:n,warningMessage:i}){let a=q(),l=r.getPropertyControls(a.tree,S)[t];m(l?.type==="string");let d=e&&_(e.value)?e.value:void 0,u=l.placeholder,g=l.defaultValue??"",U=d??g,c=f=>{n(t,{type:l.type,value:f})};return(0,Ur.jsx)(K,{title:l.title??"",warningMessage:i,children:l.displayTextArea?(0,Ur.jsx)(La,{value:U,onChange:c,constantChange:!0,placeholder:u,minRows:10,maxRows:30,className:zl},o.id):(0,Ur.jsx)(za,{type:l.obscured?"password":"text",value:U,onChange:c,placeholder:u,constantChange:!0,className:Nl})})}var z=y(I());function vc({fieldIdsToShow:r,requiredFieldsOnly:o,collectionItemId:e,collectionNodeId:t}){let[n,i]=(0,Et.useState)(!0),[a,s]=(0,Et.useState)(()=>new Map),l=a.size>0,d=F(),{treeStore:u,projectStore:g,modalStore:U}=d.stores,c=e!==d.stores.canvasStore.temporaryCollectionItemNodeId,f=u.tree.getNodeWithTrait(t,zt),w=u.tree.getNodeWithTrait(e,Xe);(0,Et.useEffect)(()=>{(!w||!f||w.parentid!==f.id)&&U.dismiss()},[w,f,U]);let p=o||c,P=()=>{for(let[$,M]of a)u.tree.current(w)?.setControlProp($,M);p?c?(u.tree.current(w)?.set({privateToUserId:void 0}),g.commitTreeAndSend()):d.stores.canvasStore.saveTemporaryCollectionItem():g.commitTreeAndSend(),U.dismissAll()},b=()=>{if(!sr()){if(c&&v.size>0){i(!1);return}P()}},v=nm({collectionNode:f||void 0,collectionItemNode:w||void 0,tempControlProps:a,fieldIdsToShow:r});function D($){let O=f?.getPropertyControls(u.tree,S)?.[$];if(!O)return;let et=v.get($);if(!(et?.type==="required"&&!(c&&!n)))return fr(et,O)}let x=($,M)=>{m(w,"CollectionItemNode must be present");let O=w.getControlProp($);s(et=>O?.value===M.value?uo.remove(et,$):Bo(O?.value)&&Bo(M.value)&&Cs(O.value,M.value)?uo.remove(et,$):Pc(O)&&Pc(M)?uo.remove(et,$):uo.set(et,$,M))},E=()=>{if(!l){L();return}U.push({type:"Confirmation",title:"Unsaved Changes",description:"Are you sure that you want to discard your new item?",interactionRequired:!0,onConfirm:()=>L(),cancelLabel:"Continue Editing",confirmLabel:"Discard Item",dismissVariant:"primary",variant:"destructiveSecondary",cancelOnEnter:!0,confirmOnEnter:!1,source:"on_page_hud",buttonDirection:"column",hasBackdrop:!0})},L=()=>{w&&(u.tree.remove(w.id),g.commitTreeAndSend(),U.dismiss())},ue=()=>{if(c){E();return}if(o){U.dismiss();return}P()},re=()=>{if(c){E();return}U.dismiss()};return(0,z.jsxs)(_t,{hasBackdrop:!0,className:tc,visible:r.length>0,onDismiss:ue,onConfirm:b,children:[(0,z.jsx)(qt,{separator:!0,title:c?"New Item":o?"Required Fields":"All Fields",className:oc,children:(0,z.jsx)(Kt,{onDismiss:re})}),(0,z.jsxs)($a,{className:rc,children:[(0,z.jsx)(_a,{size:0}),r.map($=>{if(!f||!w)return null;let M=f.getVariable($);if(!M)return null;let O=a.get($)??w.getControlProp($);return(0,z.jsx)(rm,{variable:M,collectionItemNode:w,collectionNode:f,controlProp:O,onChange:x,getWarningMessage:D},$)})]}),(0,z.jsx)(Xo,{displayDivider:!1,paddingTop:nc,className:ic,children:(0,z.jsxs)(ba,{children:[o?(0,z.jsx)(Y,{bold:!0,onClick:re,className:hr,children:(0,z.jsx)(ot,{children:"Cancel"})}):(0,z.jsx)(Y,{bold:!0,onClick:re,className:hr,children:(0,z.jsx)(ot,{children:l?"Discard":"Cancel"})}),(0,z.jsx)(Y,{bold:!0,type:"submit",variant:"primary",className:hr,enabled:o?v.size===0:l,children:(0,z.jsx)(ot,{children:"Save"})})]})})]})}function rm({variable:r,collectionItemNode:o,collectionNode:e,controlProp:t,onChange:n,getWarningMessage:i}){let a=r.type;switch(a){case"slug":return ho(r)?(0,z.jsx)(Ll,{collectionNode:e,collectionItemNode:o,controlProp:t,onChange:n,variable:r,warningMessage:i(r.id)}):null;case"string":return(0,z.jsx)(Fc,{collectionNode:e,collectionItemNode:o,controlProp:t,variableId:r.id,onChange:n,warningMessage:i(r.id)});case"richtext":return(0,z.jsx)(xc,{collectionNode:e,collectionItemNode:o,controlProp:t,variableId:r.id,onChange:n,warningMessage:i(r.id)});case"link":return(0,z.jsx)(hc,{collectionItemNode:o,collectionNode:e,controlProp:t,variableId:r.id,warningMessage:i(r.id),onChange:n});case"image":return(0,z.jsx)(yc,{collectionItemNode:o,collectionNode:e,controlProp:t,variableId:r.id,warningMessage:i(r.id),onChange:n});case"array":return(0,z.jsx)(gc,{collectionItemNode:o,collectionNode:e,controlProp:t,variableId:r.id,onChange:n});case"multicollectionreference":return(0,z.jsx)(Uc,{collectionNode:e,controlProp:t,variableId:r.id,warningMessage:i(r.id),onChange:n});case"collectionreference":return(0,z.jsx)(dc,{collectionNode:e,controlProp:t,variableId:r.id,warningMessage:i(r.id),onChange:n});case"file":return(0,z.jsx)(uc,{collectionItemNode:o,collectionNode:e,controlProp:t,variableId:r.id,warningMessage:i(r.id),onChange:n});case"date":return(0,z.jsx)(mc,{collectionItemNode:o,collectionNode:e,controlProp:t,variableId:r.id,warningMessage:i(r.id),onChange:n});case"number":return(0,z.jsx)(wc,{collectionItemNode:o,collectionNode:e,controlProp:t,variableId:r.id,warningMessage:i(r.id),onChange:n});case"boolean":return(0,z.jsx)(ec,{collectionItemNode:o,collectionNode:e,controlProp:t,variableId:r.id,warningMessage:i(r.id),onChange:n});case"enum":return(0,z.jsx)(pc,{collectionItemNode:o,collectionNode:e,controlProp:t,variableId:r.id,warningMessage:i(r.id),onChange:n});case"color":return(0,z.jsx)(fc,{collectionItemNode:o,collectionNode:e,controlProp:t,variableId:r.id,warningMessage:i(r.id),onChange:n});default:Ei(a)}}function nm({collectionNode:r,collectionItemNode:o,tempControlProps:e,fieldIdsToShow:t}){let n=F(),i=T(()=>n.stores.treeStore.tree,[]),a=_s(r,o);return(0,Et.useMemo)(()=>{let s=new Map;if(!r||!o)return s;for(let l of t){let d=r.getVariable(l);if(!d)continue;let g=r.getPropertyControls(i,S)[l];if(!g)continue;let U=e.get(l)??o.getControlProp(l),c=a.get(l),f;(Mo(d)||ho(d))&&(f=cr(d,r.variables,o));let w=dr(d.type,g,U,f,void 0,Vo(d),c);w&&s.set(l,w)}return s},[r,o,t,a,i,e])}function Pc(r){return!r||Ri(r.value)?!0:_(r.value)?ns(r.value):Bo(r.value)?r.value.length===0:!1}var Cr=y(ie());var bc="e1zu74n";var Ec=y(I());function Sc({initialHtml:r,onContentChange:o,onEscape:e}){let t=(0,Cr.useRef)(null);return(0,Cr.useEffect)(()=>{let n;async function i(){let{baseKeymap:a,chainCommands:s,dropCursor:l,gapCursor:d,history:u,keymap:g,redo:U,undo:c,undoInputRule:f}=await Gt(),w=Ie.isOn("pasteMarkdown")?(D,x,E)=>_o(D,x,E):(D,x,E)=>qo(D,E),p=pt(zo),P=w(r,p,{plugins:[u(),g({"Mod-z":s(f,c),"Mod-Shift-z":U,"Shift-Enter":rr(p),"Mod-b":yn(p.marks.bold),"Mod-i":yn(p.marks.italic),"Shift-Tab":ls(p.nodes.listItem),Tab:s(cs(p.nodes.listItem),()=>!0),Backspace:s(f,nr(p)),Escape:()=>(e?.(),!!e)}),g(a),l({color:"var(--framer-color-text)",width:2}),d(),ir()]}),b,v=new ra(null,{state:P,editable:()=>!0,dispatchTransaction:D=>{let x=v.state.apply(D);if(v.updateState(x),b!==x.doc){let E=Ie.isOn("pasteMarkdown")?Ho(x.doc,p):jo(x.doc);o(E),b=x.doc}}});t.current&&(t.current.innerHTML="",t.current.appendChild(v.dom)),n=v}return i(),()=>n?.destroy()},[r,o,e]),(0,Ec.jsx)("div",{ref:t,className:bc})}function at({tree:r,webPageNodeId:o}){let e=r.getNodeWithTrait(o,_i);if(e?.loaded)return e.loaded;e?.load().catch(de)}function ye({screenWidth:r,tree:o,webPageNodeId:e}){let n=at({tree:o,webPageNodeId:e})?.getBreakpointValues(),i=Zi(n,r);return o.get(i)}function Ze(r,o,e){let t=e.temporaryCollectionItemNodeId??r.collectionItemNodeId;return o.tree.getNodeWithTrait(t,Xe)??void 0}function Zt(r,o,e){let t=Ze(r,o,e);if(t)return o.tree.getNodeWithTrait(t.parentid,zt)??void 0}function st(r){return window.editorBarFeatures[r]===!0}var Q=class{constructor(o){this.engine=o;h(this,"scheduler");this.scheduler=o.scheduler}};function xo(r,o,e){let t=e(o.id),i=as(o,r).find(s=>s.keyPath===t);if(i)return i;if(!o.originalid)return;let a=r.tree.getNode(o.originalid);if(a)return xo(r,a,e)}function lt(r,o){let e=jt(r.tree,r.stores.routeStore.localeId);return e&&st("onPageLocalizationSupport")&&e.id!==Wt?Lo(e,o.valueLocalized):null}function Jt(r,o,e){let t=r.tree.root.getLocale(r.stores.routeStore.localeId),n=o.value;m(_(n),"Control prop value must be a string");let i=lt(r,o);if(i&&t?.id!==Wt){let a=rt(i.value),s=Qo(a,i,n);if(s)return e?xt(n,s.value):s.type==="rich-text"?Jo(n,s.value):xt(n,s.value)}return n}function xr(r,o,e,t){let{controlProp:n,collectionItemNode:i}=o,s=lt(r,n)?.value??n.value,l=r.tree.root.getLocale(r.stores.routeStore.localeId);if(m(l.id!==Wt,"Active locale must be a non-default locale"),!_(s)){r.exitTool();return}let d=xt(s,e),u=xo(r,t,()=>or(i.id,o.variableId,void 0));m(u,"There must be a localization source for updating a localized value");let g=Ft(d);Uo(r,g,u,l,{trackingSource:"on-page-rich-text-edit-tool"})}function Qt(r,o,e,t,n,i){let a=xo(r,o,i);if(!a){r.exitTool();return}let l=rt(e)==="rich-text"?er(t):Ft(t);Uo(r,l,a,n,{trackingSource:"on-page-rich-text-edit-tool"})}var am=/^(?<hashes>#{1,6})\s$/u,we=class r extends Q{constructor(e,t,n,i="none"){super(e);this.nodeId=t;this.renderId=n;this.eventSource=i;h(this,"handleOnFocus",()=>this.proseMirrorEditor?.controls.handleOnFocus());h(this,"handleOnBlur",()=>this.proseMirrorEditor?.controls.handleOnBlur());h(this,"proseMirrorEditor",null);h(this,"hasTextFitViewBox",!1);h(this,"isEditingPlainTextLocalizedValue");this.engine.beginUndoGroup();let a=this.getRichTextNode();if(a){let s=rt(a.html),d=this.engine.stores.routeStore.localeId!==ce&&s!=="rich-text";this.isEditingPlainTextLocalizedValue=d}this.start()}getRichTextNode(){return this.engine.tree.getNodeWithTrait(this.nodeId,A)}update(){let e=this.getRichTextNode();if(!e||!r.supportsNode(this.engine,e)){this.engine.exitTool();return}let t=this.engine.stores.routeStore.localeId,n=rt(e.html),i=t!==ce&&n!=="rich-text";if(this.isEditingPlainTextLocalizedValue!==void 0&&i!==this.isEditingPlainTextLocalizedValue){this.engine.exitTool();return}if(!e.textFitViewBoxSize||this.hasTextFitViewBox)return;let a=Ia(this.engine.tree,e);this.engine.stores.projectStore.commitTreeAndSend(),a&&(this.hasTextFitViewBox=!0)}async stop(){let e=this.getRichTextNode();e&&(e.cache.isEditable=!1),this.proseMirrorEditor?.destroy(),this.proseMirrorEditor=null,this.engine.endUndoGroup(),this.engine.stores.toolStore.proseMirrorView=null,this.engine.stores.toolStore.nodeInTextEditorId=null}start(){let e=this.getRichTextNode();if(!e)return;this.hasTextFitViewBox=ga(this.engine.tree,e),this.engine.stores.projectStore.commitTreeAndSend();let t=ar(this.engine.tree,e);if(t.length===0){this.init();return}ft.loadFonts(t).catch(de).finally(()=>this.init())}init(){this.startAsync().catch(e=>{de(e),this.engine.exitTool()})}async startAsync(){let e=this.getRichTextNode();if(!e)return this.engine.exitTool();this.proseMirrorEditor=await this.createProseMirrorEditor(e),e.cache.isEditable=!0,this.engine.stores.toolStore.proseMirrorView=this.proseMirrorEditor.view}async createProseMirrorEditor(e){let{baseKeymap:t,chainCommands:n,createParagraphNear:i,Decoration:a,DecorationSet:s,dropCursor:l,EditorView:d,ellipsis:u,emDash:g,gapCursor:U,history:c,InputRule:f,inputRules:w,keymap:p,liftEmptyBlock:P,liftListItem:b,newlineInCode:v,redo:D,sinkListItem:x,splitBlock:E,splitListItem:L,toggleMark:ue,undo:re,undoInputRule:$}=await Gt(),M=this.engine,O=pt(zo),et=n(L(O.nodes.listItem),v,i,P,fs(O),ds(O),(ne,X)=>E(ne,X&&(Z=>{let Se=ne.selection,Ge=this.getRichTextNode();m(Ge,"RichTextNode not found");let Ye=Se.$from.node(1);if(!ln(Ye)||!(Se.$to.parentOffset===Se.$to.parent.content.size))return X(Z);let Ee={...Ye.attrs},Ct=sn(Ye)&&Ee.tag!=="p",mo=Z.mapping.map(ne.selection.to),Ot=ne.selection.$from.marks();if(Ct){let tt=Ge.getNodeTextStylePreset(M.tree,"p")??fn(M.tree,"p")??cn.createDefault("p");mn(M,tt),Ge.setNodeTextStylePreset(tt),M.stores.projectStore.commitTreeAndSend(),Ee.textStylePreset=tt.id,Ee.tag="p",Ee.inlineStyles={},Ee.blockStyles={}}else{let tt=Ot.find(ea);Ee.inlineStyles={...Ee.inlineStyles,...tt?.attrs.inlineStyles}}Z.setNodeMarkup(mo-1,void 0,Ee),Z.setStoredMarks(Ot),Ct&&Z.removeStoredMark(O.marks.inlineStyles),X(Z)})));function xi(){return M.exitTool(),!0}m(!W(e.htmlContent),"Can't edit rich text node when htmlContent variable is assigned"),m(!W(e.textContent),"Can't edit rich text node when textContent variable is assigned");let Qr=()=>{let ne=this.getRichTextNode();m(ne,"RichTextNode not found");let X=ne.getNodeInlineCodeStylePreset(M.tree)??pa(M.tree)??new fa;return ua(M,X),ne.setNodeInlineCodeStylePreset(X),X.id},Fi=Ie.isOn("pasteMarkdown")?(ne,X,Z)=>_o(ne,X,Z):(ne,X,Z)=>qo(ne,Z),Xf=lm(M,e),Pi=Fi(Xf,O,{plugins:[c(),p({"Mod-z":n($,re),"Mod-Shift-z":D,"Shift-Enter":rr(O),...this.isEditingPlainTextLocalizedValue?{}:{"Mod-b":ue(O.marks.bold),"Mod-i":ue(O.marks.italic)},"Shift-Tab":b(O.nodes.listItem),Tab:n(x(O.nodes.listItem),()=>!0),Backspace:n($,nr(O)),Escape:xi,Enter:et,"Mod-Shift-c":ue(O.marks.inlineCode,{get inlineCodeStylePreset(){return Qr()}})}),p(t),l({color:va.cmsRichTextDropCursor,width:Ue.richTextDropCursor}),U(),ir(),hs({engine:this.engine,schema:O,nodeId:this.nodeId,getRichTextNode:()=>this.getRichTextNode()}),w({rules:[g,u,new f(am,(ne,X,Z,Se)=>{let Ge=ne.doc.resolve(Z),Ye=Ge.node(1),Eo=Ge.before(1);if(!ln(Ye))return null;let Ee=ne.tr,Ct="h"+(X.groups?.hashes?.length||1),mo=this.getRichTextNode();m(mo,"RichTextNode not found");let Ot=mo.getNodeTextStylePreset(M.tree,Ct)??fn(M.tree,Ct)??cn.createDefault(Ct),tt=Ot.id;return mn(M,Ot),mo.setNodeTextStylePreset(Ot),M.stores.projectStore.commitTreeAndSend(),sn(Ye)||Ee.removeMark(Eo,Eo+Ye.nodeSize,O.marks.inlineStyles),Ee.delete(Z,Se),Ee.setNodeMarkup(Eo,O.nodes.textBlock,{...Ye.attrs,blockStyles:tt?{}:Ye.attrs.blockStyles,inlineStyles:tt?{}:Ye.attrs.inlineStyles,textStylePreset:tt,tag:Ct}),Ee}),ms(O),ps(O)]}),...ss({markType:O.marks.inlineCode,attrs:{get inlineCodeStylePreset(){return Qr()}}})]}),vi,dt=new d(null,{state:Pi,dispatchTransaction:ne=>{let X=M.tree.root.getLocale(M.stores.routeStore.localeId),Z=this.getRichTextNode();m(Z,"Node should not be null");let Se=dt.state.apply(ne);if(dt.updateState(Se),Se=ya(Se,dt,Z),vi!==Se.doc){let Ge=Ie.isOn("pasteMarkdown")?Ho(Se.doc,O):jo(Se.doc);Z.html!==Ge&&(X&&X.id!==ce&&st("onPageLocalizationSupport")?Qt(M,Z,Z.html,Ge,X,is):r.updateNodeWithBreakpointAwareness({engine:this.engine,html:Ge,node:Z}),ha(Z,dt)),vi=Se.doc}this.engine.stores.projectStore.commitTreeAndSend()}});return{controls:{handleOnFocus(){dt.setProps({decorations(){}})},handleOnBlur(){dt.setProps({decorations(ne){let X=ne.selection;if(X.from!==X.to)return document.getSelection()?.removeAllRanges(),s.create(ne.doc,[a.inline(X.from,X.to,{class:"selection",nodeName:"mark"})])}})}},destroy:()=>dt.destroy(),state:Pi,view:dt}}static updateNodeWithBreakpointAwareness({engine:e,node:t,html:n,breakpointNode:i}){let{tree:a,stores:s}=e,{routeStore:l,canvasStore:d,treeStore:u}=s;i??=ye({screenWidth:d.screenWidth,tree:u.tree,webPageNodeId:l.webPageNodeId});let g=t.getPrimaryId(),U=!Wi(i)||$i(i)||!g,c=!Ko(a,t,"html"),f=a.getNodeWithTrait(g,A);if(m(f,`originalNode with id ${g} must exist`),U||c){f.set({html:n});return}if(t.getTextContent()===f.getTextContent()){f.set({html:xt(f.html,Ft(n))});return}t.set({html:n},a,!1,!1)}static supportsNode(e,t){return!A(t)||e.tree.root.getLocale(e.stores.routeStore.localeId).id!==ce&&t.textFitViewBoxSize?!1:!t.htmlContent&&!t.textContent}};function sm(r,o){let e=jt(r.tree,r.stores.routeStore.localeId);return e&&o.htmlLocalized&&st("onPageLocalizationSupport")?Lo(e,o.htmlLocalized):null}function lm(r,o){let e=sm(r,o);if(e){let t=rt(o.html),n=Qo(t,e,o.html);return n?n.type==="rich-text"?Jo(o.html,n.value):xt(o.html,n.value):o.html}return o.html}function Ce(){let r=F();return T(()=>at({tree:r.stores.treeStore.tree,webPageNodeId:r.stores.routeStore.webPageNodeId}),[])}function Tc(){let r=F(),{routeStore:o,treeStore:e,canvasStore:t}=r.stores;return nt(()=>Ze(o,e,t),[],[o,e,t])}function Nc(){let r=F(),{routeStore:o,treeStore:e,canvasStore:t}=r.stores;return nt(()=>Zt(o,e,t),[],[o,e,t])}var Ae=y(ie());var Ac="m168h77v";var xe=y(I());function Dc({richTextNodeId:r}){let o=F(),e=Ce(),[t,n]=(0,Ae.useState)(()=>{let f=ye({screenWidth:o.stores.canvasStore.screenWidth,tree:o.stores.treeStore.tree,webPageNodeId:o.stores.routeStore.webPageNodeId});return m(f,"activeOnPageBreakpointNode must exist"),f.id}),i=(0,Ae.useRef)(new Map),a=(0,Ae.useMemo)(()=>{let f=o.stores.treeStore.tree.getNodeWithTrait(r,A);return f?f.getPrimaryId():r},[r]),s=(0,Ae.useCallback)(()=>o.stores.scopeStore.active.getTopLevelReplicaVariants().find(({id:f})=>t===f),[t]),l=(0,Ae.useCallback)(()=>{let f=s();if(!f)return;let w=Io(f.id,a),p=o.stores.treeStore.tree.get(w);return A(p)?p:void 0},[s,a]),d=T(()=>o.stores.scopeStore.active.getPrimaryVariant().id,[]),u=(0,Ae.useMemo)(()=>{let f=i.current.get(t);if(f!==void 0)return f;if(t===d){let w=o.stores.treeStore.tree.getNodeWithTrait(a,A);return m(w,"originalNode should exist"),w.html}return l()?.html??""},[l,d,t,a]),g=(0,Ae.useCallback)(f=>i.current.set(t,f),[t]),U=(0,Ae.useCallback)(()=>{o.exitTool(),o.stores.modalStore.dismiss()},[]),c=(0,Ae.useCallback)(()=>{let f=o.stores.scopeStore.active.getPrimaryVariant(),w=i.current.get(f.id);if(w!==void 0){let p=o.stores.treeStore.tree.getNodeWithTrait(a,A);m(p,`originalNode with id ${a} must exist`),p.html!==w&&p.set({html:w})}o.stores.scopeStore.active.getTopLevelReplicaVariants().forEach(p=>{let P=i.current.get(p.id);if(P===void 0)return;let b=Io(p.id,a),v=o.stores.treeStore.tree.get(b);A(v)&&v.html!==P&&we.updateNodeWithBreakpointAwareness({breakpointNode:p,engine:o,html:P,node:v})}),i.current.clear(),o.stores.projectStore.commitTreeAndSend(),U()},[U,a]);return(0,xe.jsxs)(_t,{visible:!0,hasBackdrop:!0,onDismiss:U,className:Ac,children:[(0,xe.jsx)(qt,{separator:!0,title:"Responsive Text",children:(0,xe.jsx)(Kt,{onDismiss:U})}),(0,xe.jsxs)(Ne,{gap:Ue.inputSpacing,paddingTop:Ue.modalPadding,children:[(0,xe.jsx)(Ya,{children:e?.getTopLevelVariants().map(f=>(0,xe.jsx)(Ga,{identifier:f.id,title:f.resolveValue("name")??f.id,selected:t===f.id,onSelect:n},f.id))}),(0,xe.jsx)(Sc,{initialHtml:u,onContentChange:g,onEscape:U})]}),(0,xe.jsxs)(Xo,{displayDivider:!0,children:[(0,xe.jsx)(Y,{bold:!0,onClick:U,variant:"default",children:(0,xe.jsx)(ot,{children:"Cancel"})}),(0,xe.jsx)(Y,{bold:!0,onClick:c,variant:"primary",children:(0,xe.jsx)(ot,{children:"Save"})})]})]})}var Fe=class r extends Q{constructor(e,t,n,i){super(e);this.nodeId=t;this.renderId=n;this.eventSource=i;h(this,"controls");this.engine.beginUndoGroup(),Gt().then(a=>{e.stores.toolStore.proseMirror??=a})}getRichTextNode(){return this.engine.tree.getNodeWithTrait(this.nodeId,A)}getVariableReference(){let e=this.getRichTextNode();if(!e)return;let t=e.htmlContent;if(W(t))return t}getVariableInfo(){let e=this.getRichTextNode();if(!e)return;let t=e.cache.getRenderInstance(this.renderId);if(!t)return;let n=this.getVariableReference();if(n)return H(this.engine.tree,this.engine.stores.treeStore.sandboxCollectionData,n,"richtext",t.collectionItemId)}getValue(){let e=this.getVariableInfo();if(!e)return;let{controlProp:t}=e;return m(t,"Control prop must exist"),Jt(this.engine,t)}changeValue(e){let t=this.getVariableInfo();if(!t)return;let{collectionItemNode:n,variableDefinition:i,controlProp:a}=t;m(a,"Control prop must exist");let s=this.engine.tree.root.getLocale(this.engine.stores.routeStore.localeId);if(s.id!==ce){let d=lt(this.engine,a)?.value??a.value;if(!_(d)){this.engine.exitTool();return}r.updateLocalizedValue(this.engine,n,i.id,d,e,s)}else{if(a.value===e)return;n.setControlProp(i.id,{...a,value:e})}this.engine.stores.projectStore.commitTreeAndSend()}static updateLocalizedValue(e,t,n,i,a,s){let l=xo(e,t,()=>or(t.id,n,void 0));m(l,"There must be a localization source for updating a localized value");let u=rt(i)==="rich-text"?er(a):Ft(a);Uo(e,u,l,s,{trackingSource:"on-page-rich-text-edit-tool"})}update(){let e=this.engine,t=this.getRichTextNode();if(!t||!r.supportsNode(e,t,this.renderId))e.exitTool();else{let n=this.getVariableInfo();this.engine.stores.toolStore.validateCollectionControl(n)}}stop(){this.engine.endUndoGroup(),this.engine.stores.toolStore.nodeInTextEditorId=null}static supportsNode(e,t,n){if(!A(t)||!W(t.htmlContent))return!1;let i=t.cache.getRenderInstance(n);return i?!!H(e.tree,e.stores.treeStore.sandboxCollectionData,t.htmlContent,"richtext",i.collectionItemId):!1}};var Fr=y(ie());var Bc="m1cvfiap",Rc="f1nz04q2",kc="syo0l7n",Oc="w9541mz",Bn="e73gufq";var ht=y(I()),Mc=["left","right","auto-vertical"];function Vc({controlKey:r,nodeId:o}){let e=F(),t=()=>{e.stores.modalStore.dismiss()},n=nt(()=>{let c=e.stores.treeStore.tree.get(o);return!Xe(c)&&!ke(c)?null:c},[o],["Tree"]),i=nt(()=>{let U=e.tree.getScopeNodeFor(n);return U?Qa(U):null},[n],["Tree"]),a=nt(()=>{if(Xe(n)){let U=n?.parentid,c=e.stores.treeStore.tree,f=c.getNodeWithTrait(U,zt);if(!f)return null;let p=f.getPropertyControls(c,S)[r];return p?.type==="richtext"?p:null}if(ke(n)){let U=S.reactComponentForIdentifier(n.codeComponentIdentifier);if(!U)return null;let c=U.properties[r];return c?.type==="richtext"?c:null}return null},[r,n],["Tree","ActiveBundle"]),s=(0,Fr.useMemo)(()=>{if(!n)return"";let U=Rn(n,r);return U?Jt(e,U):""},[n,r]),l=!!i&&!!n&&a?.type==="richtext",d=U=>{if(!n)return;let c=e.stores.treeStore.tree.current(n);if(!c)return;let f=e.tree.root.getLocale(e.stores.routeStore.localeId);if(f.id!==ce){if(Xe(c)){let P=c.getControlProp(r);if(!P||P.type!=="richtext")return;let v=lt(e,P)?.value??P.value;if(!_(v)){e.stores.modalStore.dismiss();return}Fe.updateLocalizedValue(e,c,r,v,U,f);return}if(ke(c)){let P=Rn(c,r);if(!P||!_(P.value)){e.stores.modalStore.dismiss(),e.exitTool();return}Qt(e,c,P.value,U,f,b=>tr(b,r,void 0));return}}let w,p=Rn(n,r);p?w={...p,value:U}:w={type:"richtext",value:U},Xe(c),c.setControlProp(r,w),m(Fa(e),"Only on-page engine can commit tree"),e.stores.projectStore.commitTreeAndSend()};(0,Fr.useEffect)(()=>{l||e.stores.modalStore.dismiss()},[l]);let u=pr(()=>pt(Oo(n)?Wo:na)),g=Lt("pasteMarkdown");return l?(0,ht.jsxs)(_t,{visible:!0,hasBackdrop:!0,onDismiss:t,className:Bc,formClassName:Rc,children:[(0,ht.jsx)(qt,{separator:!0,title:a.title??"Unknown",className:Oc,children:(0,ht.jsx)(Kt,{onDismiss:t})}),(0,ht.jsx)(Wa,{className:kc,children:g?(0,ht.jsx)(ur,{enabled:!0,schema:u,className:Bn,defaultValue:s,onChange:d,scopeType:i,onUnsavedChange:gt,popoverAttachmentEdge:Mc,fallbackToModalAppearance:!0,saveOnMetaArrowNavigation:!0}):(0,ht.jsx)(gr,{enabled:!0,supportsEmbeds:Oo(n),supportsMedia:Oo(n),className:Bn,defaultValue:s,onChange:d,scopeType:i,onUnsavedChange:gt,popoverAttachmentEdge:Mc,fallbackToModalAppearance:!0,saveOnMetaArrowNavigation:!0})})]}):null}function Rn(r,o){if(Xe(r)){let e=r.getControlProp(o);return e?.type==="richtext"&&_(e.value)?e:null}if(ke(r)){let e=S.reactComponentForIdentifier(r.codeComponentIdentifier);if(!e)return null;let n=r.getControlProps(e.properties)[o];if(n?.type==="richtext"&&_(n.value))return n}return null}var Fo=y(I()),fm={AcquireAddonModal:null,AcquireAdvancedAnalyticsTrialModal:null,AddToLibrary:null,BatchTranslate:null,CodeFileCreation:null,CompleteSignup:null,ComponentIsolationModal:null,Confirmation:xl,ConfirmBatchTranslateAll:null,ConfirmDefaultLanguage:null,ConfirmDeleteCollectionItems:null,ConfirmDeleteCustomCode:null,ConfirmDestructiveFeedbackAction:null,ConfirmDraftCollectionItem:null,ConfirmDraftLocale:null,ConfirmDraftPage:null,ConfirmPublishAbTest:null,ConfirmPublishDraftCollectionItem:null,ConfirmPublishDraftLocale:null,ConfirmPublishDraftPage:null,ConfirmRemoveTriggerEvent:null,ConfirmUpdatingAbVariants:null,ConvertToCMSPage:null,CreateAbTest:null,CreateComponent:null,CreateLayoutTemplate:null,CreateManagedCollection:null,CreateTeam:null,CustomBreakpoint:null,DashboardAddHeader:null,DashboardAddRedirect:null,DashboardAddRewrite:null,DashboardEditHeader:null,DashboardEditRedirect:null,DashboardEditRewrite:null,DashboardRequestProjectAccess:null,DeleteCodeFile:null,DeleteCustomFont:null,DeleteEntityFolder:null,DeleteFile:null,DeleteMultipleCodeFiles:null,DeleteMultipleEntityFolders:null,DeprecatedDrafts:null,DuplicateProjectWithVersion:null,DuplicateWebPage:null,EditCustomCode:null,FigmaImportTutorial:null,FlexToYearly:null,ImageCrop:Fl,ImageFocalPoint:Pl,ImportFigma:null,ImportRedirects:null,LoadingFullDocument:null,LocaleReady:null,LocaleSettings:null,LocalizationGlossary:null,None:null,NudgePreferences:null,OnPageCMSFieldsModal:vc,OnPageRichTextEditor:Vc,OnPageRichTextVariantOverride:Dc,OverrideFile:null,PasteFromFigma:null,PlanCancellation:null,PluginCustomHTML:null,PluginFromURL:null,PluginWithModePicker:null,PublishModule:null,QuickActions:null,RemoveTeamLibraryModule:null,ReplaceTextStylePreset:null,ReplaceWebPage:null,SelectProjectToUpgrade:null,Shortcuts:null,StopAbTest:null,SubscriptionNotInOrder:null,TransferProject:null,Templates:null,UnlinkComponent:null,UnsavedChanges:null,UnsupportedFileSize:null,UnsupportedFileType:null,UpgradeDocument:null,UpsellEnterprise:null,UpsellFeature:null,Variables:null,VectorImport:null,VectorSetCreation:null,ViewCustomCode:null,Welcome:null,KitRemix:null};function Lc(){let o=F().stores.modalStore.useState(e=>e.stack);return o.map((e,t)=>{if(e.type==="None")return null;let n=fm[e.type];m(n,`Modal is missing: ${e.type}`);let{type:i,...a}=e,s=t===o.length-1,l=e.type+t;return(0,Fo.jsx)(Oa,{allowFocusTrap:s,children:(0,Fo.jsx)(ja.Provider,{value:Vs(i),children:(0,Fo.jsx)(Ha.Provider,{value:s?"visible":"hidden",children:(0,Fo.jsx)(n,{...a})})})},l)})}function Wc({accessStore:r,routeStore:o},e){let t=r.access;m(t.status==="success","Can't open Framer if project access is not successful");let n=e??o.projectLinkNodeId,i=`${Do().app}/projects/${t.data.projectSlug}?node=${n}`;window.open(`https://www.framer.com/open-in-app?url=${encodeURIComponent(i)}`,"_blank")}var Gc=y(ie());var Hc="t49i6vy",Tt="bjwo6qr",eo="b1qwl3y9",jc="m1wta5up",_c="m69kutt",kn="sdjdrec",qc="l9efojb";var On={slug:!0,string:!0,richtext:!0,link:!0,image:!0,array:!0,multicollectionreference:!0,collectionreference:!0,file:!0,date:!0,number:!0,boolean:!0,enum:!0,color:!0};function Pr(r){return Gs(r).flatMap(t=>{let n=t.type;return On[n]!==void 0?t.id:[]})}var B=y(I());function Yc(){let r=F(),{routeStore:o,treeStore:e,canvasStore:t,projectStore:n,modalStore:i}=r.stores,a=T(()=>r.stores.canvasStore.finishedEditing,[]),{hasPermanentlyFailed:s}=n.useState(),l=a?.isNewItem?"Page saved":"Site saved",d=Tc(),u=Nc(),g=(0,Gc.useCallback)(()=>{m(u,"Collection node must exist"),m(d,"Collection item node must exist");let f=Pr(u);r.exitTool(),i.set({type:"OnPageCMSFieldsModal",fieldIdsToShow:f,requiredFieldsOnly:!1,source:"on_page_hud",collectionItemId:d.id,collectionNodeId:u.id})},[o,e,i,r,d,u]),U=()=>{i.set({type:"Confirmation",title:"Discard Changes",description:"All changes will be lost. This action cannot be undone.",confirmLabel:"Discard",cancelLabel:"Cancel",variant:"destructive",source:"on_page_hud",onConfirm:()=>{t.discardTemporaryCollectionItem()}})},c=!!d?.privateToUserId;return(0,B.jsx)(B.Fragment,{children:(0,B.jsxs)("div",{className:Hc,children:[c?(0,B.jsxs)(Y,{className:J(Tt,eo),onClick:U,children:[(0,B.jsx)(Na,{}),"Discard Page"]}):(0,B.jsx)(pm,{finishedEditing:a}),(0,B.jsxs)("div",{className:jc,children:[(0,B.jsx)(Kc,{desktopText:"Click to edit",mobileText:"Tap to edit",secondaryText:"Changes are auto-saved",isVisible:!a}),(0,B.jsx)(Kc,{desktopText:l,mobileText:l,secondaryText:`A notification was sent to your collaborators. ${a?.isNewItem?"The page":"Changes"} will be visible when the project is published.`,isVisible:!!a})]}),(0,B.jsxs)(Ne,{direction:"row",gap:10,children:[u&&!c&&!u.managedByPlugin&&!a&&(0,B.jsxs)(Y,{className:J(Tt,eo),enabled:!s,onClick:()=>t.createTemporaryCollectionItem(),"aria-label":"Add Page",children:[(0,B.jsx)(Ba,{}),(0,B.jsx)(vr,{desktopText:"Add Page",mobileText:"Page"})]}),c&&!s&&(0,B.jsxs)(Y,{className:J(Tt,eo),onClick:g,children:[(0,B.jsx)(gm,{}),"Show All Fields"]}),a?(0,B.jsxs)(Y,{className:J(Tt,eo),onClick:()=>t.handleDismissFinishEditing(),children:[(0,B.jsx)(um,{}),"Go Back to Site"]}):(0,B.jsxs)(Y,{variant:"primary",className:Tt,onClick:()=>t.handleFinishEditing(),children:[(0,B.jsx)(Ta,{"aria-hidden":"true"}),(0,B.jsx)(vr,{desktopText:"Finish Editing",mobileText:"Done"})]})]})]})})}function Kc({desktopText:r,mobileText:o,secondaryText:e,isVisible:t}){return(0,B.jsx)(Bi,{children:t&&(0,B.jsxs)($e.div,{className:_c,initial:{marginTop:10,opacity:0},animate:{marginTop:0,opacity:1},exit:{marginTop:-10,opacity:0},children:[(0,B.jsx)(vr,{desktopText:r,mobileText:o}),(0,B.jsx)("span",{className:kn,children:"\xB7"}),(0,B.jsx)("span",{className:kn,children:e})]})})}function vr({desktopText:r,mobileText:o}){let e=Xs(`(max-width: ${Pa.tabletSmall}px)`);return!o&&e?null:(0,B.jsx)("span",{children:e?o:r})}function pm({finishedEditing:r}){let o=F(),e=()=>{Wc(o.stores,r?.isNewItem?r.nodeId:void 0)};return(0,B.jsxs)(Y,{className:J(Tt,eo),onClick:e,"aria-label":"Open in Framer",children:[(0,B.jsx)(Aa,{"aria-hidden":"true",className:qc}),(0,B.jsx)(vr,{desktopText:"Open in Framer"})]})}function um(){return(0,B.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"9",height:"9",fill:"none",children:[(0,B.jsx)("path",{d:"M 1.5 7.5 L 8 1",fill:"transparent",strokeWidth:"1.5",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"}),(0,B.jsx)("path",{d:"M 3 1 L 8 1 L 8 6",fill:"transparent",strokeWidth:"1.5",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"})]})}function gm(){return(0,B.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"11",height:"11",fill:"none",children:[(0,B.jsx)("path",{d:"M1 5.5s1.5-3 4.5-3 4.5 3 4.5 3-1.5 3-4.5 3-4.5-3-4.5-3Z",fill:"transparent",strokeWidth:"1.5",stroke:"#fff",strokeLinecap:"round",strokeLinejoin:"round"}),(0,B.jsx)("path",{d:"M5.5 4a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3Z",fill:"#fff"})]})}var He=class extends Q{constructor(e,t,n,i){super(e);this.nodeId=t;this.renderId=n;this.eventSource=i}getNode(){return this.engine.tree.getNodeWithTrait(this.nodeId,Ht)||this.engine.tree.getNodeWithTrait(this.nodeId,A)}getVariableInfo(){let e=this.getNode();if(!e)return;let t=nn(e);if(!t)return;let n=e.cache.getRenderInstance(this.renderId);if(n)return H(this.engine.tree,this.engine.stores.treeStore.sandboxCollectionData,t,"collectionreference",n.collectionItemId)}getControlProp(){return this.getVariableInfo()?.controlProp}changeValue(e){let t=this.getVariableInfo();if(!t)return;let{collectionItemNode:n,controlProp:i}=t;i.value!==e&&n.setControlProp(t.variableDefinition.id,{...i,value:e})}static supportsNode(e,t,n){let i=nn(t);if(!i)return!1;let a=t.cache.getRenderInstance(n);return a?!!H(e.tree,e.stores.treeStore.sandboxCollectionData,i,"collectionreference",a.collectionItemId):!1}};var ym=["string","richtext","image","responsiveimage"],je=class r extends Q{constructor(e,t,n){super(e);this.nodeId=t;this.renderId=n}getCodeComponentNode(){return this.engine.tree.getNodeWithTrait(this.nodeId,ke)}getEditableControls(){let e=this.getCodeComponentNode();if(e)return r.getEditableControls(this.engine,e,this.renderId)}update(){let e=this.engine,t=this.getCodeComponentNode();(!t||!r.supportsNode(e,t,this.renderId))&&e.exitTool()}stop(){let{modalStore:e}=this.engine.stores;e.stack.some(({type:n})=>n==="OnPageRichTextEditor")&&e.dismissAll()}static getEditableControls(e,t,n){let i=e.stores.routeStore.localeId,s=jt(e.tree,i).id!==ce&&st("onPageLocalizationSupport"),l=t.cache.getRenderInstance(n);if(!l)return No();let d=S.reactComponentForIdentifier(t.codeComponentIdentifier);if(!d)return No();let u=t.getControlProps(d.properties);if(!u)return No();let g=[],U=El(e,t.codeComponentIdentifier);if(qi(t)&&U&&!s)if(Ki(t)){let c=H(e.tree,e.stores.treeStore.sandboxCollectionData,t.dynamicVectorSetIdentifier,"vectorsetitem",l.collectionItemId);c&&g.push({type:"collection",controlKey:"dynamicVectorSetIdentifier",variableInfo:c})}else bi(t.codeComponentIdentifier)&&g.push({type:"vectorSetItem",codeComponentIdentifier:t.codeComponentIdentifier});for(let c in u){let f=u[c];if(!f||s&&!ym.includes(f.type))continue;let w=d.properties[c];if(w){if(f.type==="enum"&&Ie.isOn("onPageEnumVariableOnComponentInstanceEditTool")&&!We(f.value)){m(w.type==="enum");let p=bt(w);m(p,"Reduced control prop should not be null"),vt(p,f,w),g.push({type:"component",controlKey:c,controlDescription:w,controlProp:f,reducedControlProp:p})}if(f.type==="string"){if(W(f.value)){let p=H(e.tree,e.stores.treeStore.sandboxCollectionData,f.value,f.type,l.collectionItemId);if(!p)continue;let P=p.controlProp,b=null;s&&an(P)&&(b=lt(e,P)),g.push({type:"collection",controlKey:c,variableInfo:p,localizedValue:b})}else if(!We(f.value)){m(w.type==="string");let p=bt(w);m(p,"Reduced control prop should not be null"),vt(p,f,w);let P=null;s&&an(f)&&(P=lt(e,f)),g.push({type:"component",controlKey:c,controlDescription:w,controlProp:f,reducedControlProp:p,localizedValue:P})}}if(f.type==="richtext"){if(W(f.value)){let p=H(e.tree,e.stores.treeStore.sandboxCollectionData,f.value,f.type,l.collectionItemId);if(!p)continue;g.push({type:"collection",controlKey:c,variableInfo:p})}else if(!We(f.value)){m(w.type==="richtext");let p=bt(w);m(p,"Reduced control prop should not be null"),vt(p,f,w),g.push({type:"component",controlKey:c,controlDescription:w,controlProp:f,reducedControlProp:p})}}if(f.type==="image"){if(W(f.value)){let p=H(e.tree,e.stores.treeStore.sandboxCollectionData,f.value,f.type,l.collectionItemId);if(!p)continue;g.push({type:"collection",controlKey:c,variableInfo:p})}else if(!We(f.value)){m(w.type==="image"||w.type==="responsiveimage");let p=bt(w);m(p,"Reduced control prop should not be null"),vt(p,f,w),g.push({type:"component",controlKey:c,controlDescription:w,controlProp:f,reducedControlProp:p})}}if(f.type==="date"){if(W(f.value)){let p=H(e.tree,e.stores.treeStore.sandboxCollectionData,f.value,"date",l.collectionItemId);if(!p)continue;g.push({type:"collection",controlKey:c,variableInfo:p})}else if(!We(f.value)){m(w.type==="date");let p=bt(w);m(p,"Reduced control prop should not be null"),vt(p,f,w),g.push({type:"component",controlKey:c,controlDescription:w,controlProp:f,reducedControlProp:p})}}if(f.type==="vectorsetitem"){if(W(f.value)){let p=H(e.tree,e.stores.treeStore.sandboxCollectionData,f.value,"vectorsetitem",l.collectionItemId);if(!p)continue;g.push({type:"collection",controlKey:c,variableInfo:p})}else if(!We(f.value)){m(w.type==="vectorsetitem");let p=bt(w);m(p,"Reduced control prop should not be null"),vt(p,f,w),g.push({type:"component",controlKey:c,controlDescription:w,controlProp:f,reducedControlProp:p})}}if(f.type==="link"&&W(f.value)){let p=H(e.tree,e.stores.treeStore.sandboxCollectionData,f.value,"link",l.collectionItemId);if(!p)continue;g.push({type:"collection",controlKey:c,variableInfo:p})}if(f.type==="boolean"&&W(f.value)){let p=H(e.tree,e.stores.treeStore.sandboxCollectionData,f.value,"boolean",l.collectionItemId);if(!p)continue;g.push({type:"collection",controlKey:c,variableInfo:p})}}}return g}static supportsNode(e,t,n){return ke(t)?r.getEditableControls(e,t,n).length>0:!1}};var _e=class r extends Q{constructor(e,t,n,i){super(e);this.nodeId=t;this.renderId=n;this.eventSource=i}getRichTextNode(){return this.engine.tree.getNodeWithTrait(this.nodeId,A)}getVariableInfo(){let e=this.getRichTextNode();if(!e)return;let t=e.cache.getRenderInstance(this.renderId);if(!t)return;let n=r.getVariableReference(e);if(n)return H(this.engine.tree,this.engine.stores.treeStore.sandboxCollectionData,n,"date",t.collectionItemId)}getControlProp(){return this.getVariableInfo()?.controlProp}changeValue(e){let t=this.getVariableInfo();if(!t)return;let{collectionItemNode:n,variableDefinition:i,controlProp:a}=t;a.value!==e&&(n.setControlProp(i.id,{...a,value:e}),this.engine.stores.projectStore.commitTreeAndSend())}update(){let e=this.engine,t=this.getRichTextNode();(!t||!r.supportsNode(e,t,this.renderId))&&e.exitTool()}static getVariableReference(e){let t=e.textContent;if(!Ro(t))return;let n=t.startValue;if(W(n))return n}static supportsNode(e,t,n){if(!A(t))return!1;let i=r.getVariableReference(t);if(!i)return!1;let a=t.cache.getRenderInstance(n);return a?!!H(e.tree,e.stores.treeStore.sandboxCollectionData,i,"date",a.collectionItemId):!1}};var qe=class r extends Q{constructor(e,t,n,i){super(e);this.nodeId=t;this.renderId=n;this.eventSource=i}getRichTextNode(){return this.engine.tree.getNodeWithTrait(this.nodeId,A)}static getVariableReference(e){let t=e.textContent;if(!Ro(t))return;let n=t.startValue;if(W(n))return n}getVariableInfo(){let e=this.getRichTextNode();if(!e)return;let t=e.cache.getRenderInstance(this.renderId);if(!t)return;let n=r.getVariableReference(e);if(n)return H(this.engine.tree,this.engine.stores.treeStore.sandboxCollectionData,n,"enum",t.collectionItemId)}getControlProp(){return this.getVariableInfo()?.controlProp}changeValue(e){let t=this.getVariableInfo();if(!t)return;let{collectionItemNode:n,variableDefinition:i,controlProp:a}=t;a.value!==e&&(n.setControlProp(i.id,{...a,value:e}),this.engine.stores.projectStore.commitTreeAndSend())}static supportsNode(e,t,n){if(!A(t))return!1;let i=r.getVariableReference(t);if(!i)return!1;let a=t.cache.getRenderInstance(n);return a?!!H(e.tree,e.stores.treeStore.sandboxCollectionData,i,"enum",a.collectionItemId):!1}};var Ke=class r extends Q{constructor(e,t,n){super(e);this.nodeId=t;this.renderId=n}update(){let e=this.engine,t=e.tree.get(this.nodeId);(!t||!r.supportsNode(e,t,this.renderId))&&e.exitTool()}static supportsNode(e,t,n){if(!Ht(t))return!1;if(W(t.fillImage)){let i=t.cache.getRenderInstance(n);return i?!!H(e.tree,e.stores.treeStore.sandboxCollectionData,t.fillImage,"image",i.collectionItemId):!1}return!zi(t.fillImage)}};var $c,Xc,br,Mn,he=class extends(Xc=Q,$c=[k()],Xc){constructor(e,t,n,i){super(e);this.nodeId=t;this.renderId=n;this.onCancelWithoutMove=i;R(this,Mn,C(br,8,this,!1)),C(br,11,this);h(this,"beginState",null);h(this,"beginStates",new Map);h(this,"previousInsertionIndex");h(this,"handleKeyDown",()=>{});h(this,"state");let{mouseStore:a}=this.engine.stores,s=e.tree.get(this.nodeId);V(s,"Node must exist"),this.beginState=ts(e.tree,s,a.canvasMousePosition),this.beginStates.set(s,this.beginState),this.listenForEscapeKey()}listenForEscapeKey(){this.handleKeyDown=e=>{if(e.key==="Escape"){let t=yo(this.beginState?.parent)?this.beginState.parent.getChildrenInVisualOrder().findIndex(n=>n.id===this.nodeId):-1;this.previousInsertionIndex=t,e.preventDefault(),e.stopPropagation(),this.endMoveTool()}},window.addEventListener("keydown",this.handleKeyDown)}endMoveTool(){this.hasMoved?this.commitMove():this.onCancelWithoutMove()}update(){let{treeStore:e,mouseStore:t,canvasStore:n,routeStore:i}=this.engine.stores,a=e.tree.get(this.nodeId);if(!a)return this.endMoveTool();let s=ye({screenWidth:n.screenWidth,tree:e.tree,webPageNodeId:i.webPageNodeId});if(!t.isMouseDown||!s){this.endMoveTool();return}let d=e.tree,u=t.canvasMousePosition;V(this.beginState,"beginState must be defined"),V(yo(this.beginState.parent),"parent must be a stack or grid component");let g=le.subtract(u,this.beginState.canvasPointUnderMouse);if(this.hasMoved=g.x!==0||g.y!==0,!this.hasMoved)return;let U=this.getPlaceholder(a,this.beginState.parent);if(!U)return;let c=this.beginState.rect,f=le.add(c,g),p=a.cache.getRenderInstance(this.renderId)?.parentRenderId??this.beginState.parent.id,P=d.convertPointToCanvas(this.beginState.parent,f,void 0,void 0,p);this.state={renderId:this.renderId,nodeId:this.nodeId,rect:{height:U.size.height,left:P.x,top:P.y,width:U.size.width},placeholder:U}}stop(){window.removeEventListener("keydown",this.handleKeyDown)}commitMove(){let{treeStore:e}=this.engine.stores,t=e.tree.get(this.nodeId);if(!t){this.state=void 0,this.engine.exitTool();return}let n=yo(this.beginState?.parent)?this.beginState.parent.getChildrenInVisualOrder().findIndex(i=>i.id===t.id):-1;this.beginState?.parent&&go(this.previousInsertionIndex)&&this.previousInsertionIndex!==n&&this.engine.tree.moveNode(t,this.beginState.parent.id,this.previousInsertionIndex),this.state=void 0,this.engine.stores.projectStore.commitTreeAndSend(),setTimeout(()=>{this.engine.exitTool()},50)}getPlaceholder(e,t){if(!e)return null;let n=this.engine.tree.getRect(e,void 0,void 0,void 0,this.renderId),a=e.cache.getRenderInstance(this.renderId)?.parentRenderId??t.id,s={width:n.width,height:n.height},l=es(this.engine.tree,this.engine.stores.treeStore.layoutCache,this.engine.stores.mouseStore.canvasMousePosition,this.engine.stores.mouseStore.previous.canvasMousePosition,this.beginStates,t,this.engine.tree.convertPointToNode(t,this.engine.stores.mouseStore.canvasMousePosition,void 0,a),this.previousInsertionIndex);return s&&go(l)&&t?(this.previousInsertionIndex!==l&&(this.previousInsertionIndex=l),{renderId:a,nodeId:t.id,size:s,index:l}):null}static supportsNode(e,t){let n=t.parentid?e.tree.get(t.parentid):null;if(!n?.children)return!1;let i=n&&n.children.length>1;return Ie.isOn("onPageMoveTool")&&yo(n)&&!aa(t)&&i&&!ia(t)&&!e.stores.canvasStore.temporaryCollectionItemNodeId}};br=ae(Xc),Mn=new WeakMap,N(br,4,"hasMoved",$c,he,Mn),se(br,he);var Ve=class r extends Q{constructor(e,t,n,i){super(e);this.nodeId=t;this.renderId=n;this.eventSource=i;this.engine.beginUndoGroup();let a=this.getRichTextNode();m(a,"Missing rich text node");let s=ar(this.engine.tree,a);ft.loadFonts(s).catch(de)}getRichTextNode(){return this.engine.tree.getNodeWithTrait(this.nodeId,A)}getVariableReference(){let e=this.getRichTextNode();if(!e)return;let t=e.textContent;if(W(t))return t}getVariableInfo(){let e=this.getRichTextNode();if(!e)return;let t=e.cache.getRenderInstance(this.renderId);if(!t)return;let n=this.getVariableReference();if(n)return H(this.engine.tree,this.engine.stores.treeStore.sandboxCollectionData,n,"string",t.collectionItemId)}getControlProp(){return this.getVariableInfo()?.controlProp}getValue(){let e=this.getVariableInfo();if(!e)return;let{controlProp:t}=e;return m(t,"Control prop must exist"),Jt(this.engine,t,"text")}changeValue(e){let t=this.getVariableInfo(),n=this.getRichTextNode();if(m(n,"Rich text node must exist"),!t)return;let{collectionItemNode:i,variableDefinition:a,controlProp:s}=t;if(m(s,"Control prop must exist"),this.engine.tree.root.getLocale(this.engine.stores.routeStore.localeId).id!==Wt)xr(this.engine,t,e,n);else{if(s.value===e)return;i.setControlProp(a.id,{...s,value:e})}this.engine.stores.projectStore.commitTreeAndSend()}update(){let e=this.engine,t=this.getRichTextNode();if(!t||!r.supportsNode(e,t,this.renderId))e.exitTool();else{let n=this.getVariableInfo();this.engine.stores.toolStore.validateCollectionControl(n)}}stop(){this.engine.endUndoGroup(),this.engine.stores.toolStore.nodeInTextEditorId=null}static supportsNode(e,t,n){if(!A(t)||!W(t.textContent))return!1;let i=t.cache.getRenderInstance(n);return i?!!H(e.tree,e.stores.treeStore.sandboxCollectionData,t.textContent,"string",i.collectionItemId):!1}};var Le=class r extends Q{update(){let o=this.engine,{routeStore:e,canvasStore:t,treeStore:n,mouseStore:i,toolStore:a}=o.stores,s=ye({screenWidth:t.screenWidth,tree:n.tree,webPageNodeId:e.webPageNodeId});if(!s||i.isHoveringFloatingCanvasChrome)return;if(i.isHoveringChrome){a.highlightedRenderId=void 0;return}let l=n.tree,d=i.canvasMousePosition,u=l.getNodeRendersAtPoint(s,d,!0),g=Ua(u,l),c=g.filter(p=>r.isLockedOrBlockedByAnOverlappedLockedLayer(o,p.node,p.renderId)||r.isInteractiveNodeOrTopLevelRepeaterNode(o,p.node,p.renderId)).at(-1);if(c){o.stores.toolStore.highlightedRenderId=c.renderId;return}let w=g.filter(p=>r.isUnexpectedlyNonInteractiveNode(o,p.node,p.renderId)).at(-1);if(w){a.highlightedRenderId=w.renderId;return}a.highlightedRenderId=void 0}static isInteractiveNodeOrTopLevelRepeaterNode(o,e,t){return r.isInteractiveNode(o,e,t)||Sr(o,e)}static isHighlightableNode(o,e,t){return r.isLockedOrBlockedByAnOverlappedLockedLayer(o,e,t)?!1:je.supportsNode(o,e,t)||_e.supportsNode(o,e,t)||Ke.supportsNode(o,e,t)||we.supportsNode(o,e)||Fe.supportsNode(o,e,t)||Ve.supportsNode(o,e,t)||He.supportsNode(o,e,t)||qe.supportsNode(o,e,t)}static isNodeSupported(o,e,t){return je.supportsNode(o,e,t)||_e.supportsNode(o,e,t)||Ke.supportsNode(o,e,t)||we.supportsNode(o,e)||Fe.supportsNode(o,e,t)||Ve.supportsNode(o,e,t)||He.supportsNode(o,e,t)||qe.supportsNode(o,e,t)||he.supportsNode(o,e)}static isInteractiveNode(o,e,t){return r.isNodeSupported(o,e,t)&&!r.isLockedOrBlockedByAnOverlappedLockedLayer(o,e,t)}static isUnexpectedlyNonInteractiveNode(o,e,t){return r.isNodeSupported(o,e,t)?r.isLockedOrBlockedByAnOverlappedLockedLayer(o,e,t):sa(e)||ke(e)}static isLockedOrBlockedByAnOverlappedLockedLayer(o,e,t){if(Ie.isOff("onPageLockedLayers"))return!1;if(dn(e)&&r.isNodeSupported(o,e,t))return!0;let n=ye({screenWidth:o.stores.canvasStore.screenWidth,tree:o.stores.treeStore.tree,webPageNodeId:o.stores.routeStore.webPageNodeId});if(!n)return!1;let i=o.tree.getCornerPointsOnCanvasWithZoom(e,1),a=le.centroid(i);return[...i,a].every(d=>{let u=o.tree.getNodesAtPoint(n,d),g=Yo(u,o.tree).reverse();for(let U of g){if(dn(U)&&r.isNodeSupported(o,U,t))return!0;if(U.id===t)return!1}})}};function Sr(r,o){return!(!ji(o)||Ws(r.tree,o)||ko(r.tree.getWebPageNodeFor(o)))}var ed=y(ie());var Zc="ci35ri5",Jc="suurpvn",Qc="s1xlu29h";var Er=y(I()),td=(0,ed.memo)(function(){let o=F(),e=T(()=>o.stores.editableNodeHighlightStore.editableNodesHighlight,[]);return e?(0,Er.jsx)($e.div,{className:J(Zc,Jc),initial:{"--radius":`${e.minRadius}px`},animate:{"--radius":`${e.maxRadius}px`},transition:{duration:e.animationDuration/1e3,ease:"easeOut"},style:{top:e.minY,height:e.maxY-e.minY,"--x":`${e.originX}px`,"--y":`${e.originY}px`,"--gradient-size":`${e.gradientSize}px`},children:(0,Er.jsx)("div",{style:{position:"absolute",top:-e.minY},children:e.highlights.map(t=>(0,Er.jsx)("div",{className:Qc,style:{width:t.width,height:t.height,transform:t.transform,transformOrigin:"top left"}},t.renderId))})},e.animationId):null});var od="h1czcor4";var id=y(ie());var rd=y(ie()),nd=y(I()),oe=(0,rd.forwardRef)(function({tree:o,node:e,renderId:t,style:n,overrideRect:i,...a},s){let l=F(),d=T(()=>{if(i)return i;let g=l.stores.treeStore.domLayoutUpdate,U=o.getRect(e,void 0,void 0,void 0,t);return{width:U.width,height:U.height,x:0,y:0}},[o,e,t,i],Re.equals),u=o.transformMatrixToNode(e,void 0,void 0,t);return(0,nd.jsx)("div",{...a,ref:s,style:{position:"absolute",width:d.width,height:d.height,top:d.y,left:d.x,transformOrigin:"top left",transform:u.toString(),...n}})});var Vn=y(I());function ad({tool:r}){let{renderId:o}=r,e=Ce(),t=F(),n=t.tree,i=(0,id.useRef)(null),a=r.getNode();if($t(i,()=>{t.exitTool()}),!!a&&e)return(0,Vn.jsx)(oe,{ref:i,tree:n,node:a,renderId:o,children:(0,Vn.jsx)(ul,{tool:r,node:a,renderId:o,scopeNode:e})})}var sd="v1r7rm12";var Nr=y(I());function Um(r){return r.message}function Tr({validationWarning:r}){if(!r)return null;let o=Um(r);return(0,Nr.jsxs)("div",{className:sd,children:[(0,Nr.jsx)(Ra,{width:10,height:10}),o]})}var Po=y(I());function ld({tool:r}){let{nodeId:o,renderId:e}=r,t=F(),n=T(()=>t.stores.toolStore.validationWarning,[]),i=T(()=>t.stores.treeStore.tree,[]),a=T(()=>t.stores.toolStore.editorOverlayClipPath,[]),s=Ce(),l=T(()=>t.stores.toolStore.proseMirror,[]),d=i.getNodeWithTrait(o,A);if(!d||!s||!l)return;function u(g){g.target===g.currentTarget&&t.exitTool()}return(0,Po.jsxs)(oe,{tree:i,node:d,renderId:e,children:[(0,Po.jsx)(Tr,{validationWarning:n}),(0,Po.jsx)(Il,{tool:r,scopeNode:s,node:d,renderId:e,proseMirror:l,zoom:1,onClickOutside:u,hasValidationWarning:!!n,style:{clipPath:a}})]})}var to=y(ie());var cd="p6dts5z",dd="pcmqzkm";var Ar="nbqylm8",fd="v1pcr3uc",Ln="p1mivvux",md="t42x8tu",pd="g1atul0u",ud="n1i0g06w",gd="b1t4nog5",yd="r1wgs7ug",hd="rsrrcv7",Id="rckttk2",Ud="r12nxotj",wd="r460cpk",Cd="rrb252f",xd="rxpkzma",Fd="c1ct4jl9";var ee=y(I()),Cm=["bottom","top","right","left"],xm={x:Ue.inputSpacing,y:Ue.inputSpacing};function Fm(r){return r.controlProp.type==="string"}function vd({tool:r}){let[o,e]=(0,to.useState)(null),t=F(),n=t.stores.modalStore.useState(c=>c.active.type!=="None"),[i,a]=(0,to.useState)(!1);!i&&n&&a(!0);let s=T(()=>t.stores.treeStore.tree,[]),l=s.getNodeWithTrait(r.nodeId,Gi),d=(0,to.useMemo)(()=>{let c=s;return r.getEditableControls()},[r,s]);function u(){t.exitTool()}let g=l?.id,U=(0,to.useMemo)(()=>g?[g]:[],[g]);if(!(!l||!d||d.length===0))return(0,ee.jsx)(oe,{tree:s,node:l,ref:e,renderId:r.renderId,className:Ar,children:(0,ee.jsx)($o,{anchor:o,alignSelf:"center",attachTo:Cm,offset:xm,onClose:u,showArrow:!0,arrow:{anchor:o,alignSelf:"center"},fallbackToModalAppearance:!0,backdropTintEnabled:!1,className:J(cd,n&&dd),focusTrapEnabled:!n,animateAppear:!i,zIndex:21,children:(0,ee.jsx)(gl,{displayDivider:!0,title:Pm(l),onClose:u,children:(0,ee.jsx)(Ne,{gap:0,paddingTop:Ue.inputSpacing,paddingBottom:Ue.inputSpacing,paddingLeft:Ue.panelPadding,paddingRight:Ue.panelPadding,children:d.map(c=>{if(c.type==="vectorSetItem")return(0,ee.jsx)(Sl,{nodeIds:U,supportsVariables:!1,dynamicVectorSetIdentifier:void 0,codeComponentIdentifier:c.codeComponentIdentifier},"vectorSet");if(c.type==="component")switch(c.controlDescription.type){case"string":{m(c.reducedControlProp.type==="string");let x=c.localizedValue,E;return x&&(E={...c.reducedControlProp,value:x.value}),(0,ee.jsx)(Co,{nodeIds:U,controlKey:c.controlKey,control:c.controlDescription,controlProp:E??c.reducedControlProp,onChange:(L,ue)=>{m(c.controlProp.type==="string");let re=ue(c.controlProp),$=r.getCodeComponentNode();if(!$){t.exitTool();return}let M=t.tree.root.getLocale(t.stores.routeStore.localeId);if(M.id!==ce){if(!_(re.value)||!_(c.controlProp.value)){t.exitTool();return}Qt(t,$,c.controlProp.value,re.value,M,O=>tr(O,L,void 0))}else{if(ge(re,c.controlProp))return;l.setControlProp(L,re),t.stores.projectStore.commitTreeAndSend()}}},c.controlKey)}case"enum":return m(c.reducedControlProp.type==="enum"),(0,ee.jsx)(wo,{controlKey:c.controlKey,control:c.controlDescription,controlProp:c.reducedControlProp,onChange:(x,E)=>{m(c.controlProp.type==="enum"),!ge(x,c.controlProp)&&(l.setControlProp(E,x),t.stores.projectStore.commitTreeAndSend())}},c.controlKey);case"richtext":return m(c.reducedControlProp.type==="richtext"),(0,ee.jsx)(un,{title:c.controlDescription.title??"Unknown",children:(0,ee.jsx)(Y,{title:"Edit Content",className:pn,onClick:()=>{t.stores.modalStore.set({type:"OnPageRichTextEditor",controlKey:c.controlKey,nodeId:r.nodeId,source:"on_page_hud"})}})},c.controlKey);case"image":case"responsiveimage":return m(c.reducedControlProp.type==="image"||c.reducedControlProp.type==="responsiveimage"),(0,ee.jsx)(hn,{nodeIds:U,controlKey:c.controlKey,control:c.controlDescription,controlProp:c.reducedControlProp,onChange:(x,E)=>{m(p.type==="image");let L=E(p);ge(L,p)||(l.setControlProp(x,L),t.stores.projectStore.commitTreeAndSend())},onUpload:async(x,E)=>{let L=await x;if(!L)return;m(c.controlProp.type==="image");let ue=vl(c.controlProp,L);l.setControlProp(E,ue),t.stores.projectStore.commitTreeAndSend()}},c.controlKey);case"date":return m(c.reducedControlProp.type==="date"),(0,ee.jsx)(gn,{controlKey:c.controlKey,control:c.controlDescription,controlProp:c.reducedControlProp,onChange:(x,E)=>{m(x.type==="date"),!ge(x,p)&&(l.setControlProp(E,x),t.stores.projectStore.commitTreeAndSend())}},c.controlKey);case"vectorsetitem":return m(c.reducedControlProp.type==="vectorsetitem"),(0,ee.jsx)(In,{controlKey:c.controlKey,control:c.controlDescription,controlProp:c.reducedControlProp,onChange:(x,E)=>{m(x.type==="vectorsetitem"),!ge(x,c.controlProp)&&(l.setControlProp(E,x),t.stores.projectStore.commitTreeAndSend())}},c.controlKey);default:po(c.controlDescription)}let{variableInfo:f,localizedValue:w}=c,{controlProp:p,controlDescription:P,collectionItemNode:b,variableDefinition:v,reducedControlProp:D}=f;switch(p.type){case"string":{m(P.type==="string"),m(D.type==="string");let x;return w&&(x={...D,value:w.value}),(0,ee.jsx)(Co,{nodeIds:U,controlKey:v.id,control:P,controlProp:x??D,onChange:(E,L)=>{m(p.type==="string");let ue=t.tree.root.getLocale(t.stores.routeStore.localeId),re=L(p);if(ue.id!==ce){if(!_(re.value)||!Fm(f)){t.exitTool();return}xr(t,f,re.value,r.getCodeComponentNode())}else{if(ge(re,p))return;b.setControlProp(E,re),t.stores.projectStore.commitTreeAndSend()}}},c.controlKey)}case"enum":return m(P.type==="enum"),m(D.type==="enum"),(0,ee.jsx)(wo,{controlKey:v.id,control:P,controlProp:D,onChange:(x,E)=>{m(x.type==="enum"),!ge(x,p)&&(b.setControlProp(E,x),t.stores.projectStore.commitTreeAndSend())}},c.controlKey);case"richtext":return m(P.type==="richtext"),m(D.type==="richtext"),(0,ee.jsx)(un,{title:P.title||Li(v.id),children:(0,ee.jsx)(Y,{title:"Edit Content",className:pn,onClick:()=>{t.stores.modalStore.set({type:"OnPageRichTextEditor",controlKey:v.id,nodeId:b.id,source:"on_page_hud"})}})},c.controlKey);case"image":return m(P.type==="responsiveimage"),m(D.type==="responsiveimage"),(0,ee.jsx)(hn,{nodeIds:U,controlKey:v.id,control:P,controlProp:D,onChange:(x,E)=>{m(p.type==="image");let L=E(p);ge(L,p)||(b.setControlProp(x,L),t.stores.projectStore.commitTreeAndSend())},onUpload:async(x,E)=>{let L=await x;L&&(b.setControlProp(E,{type:"image",value:L}),t.stores.projectStore.commitTreeAndSend())}},c.controlKey);case"date":return m(P.type==="date"),m(D.type==="date"),(0,ee.jsx)(gn,{controlKey:v.id,control:P,controlProp:D,onChange:(x,E)=>{m(x.type==="date"),m(p.type==="date"),!ge(x,p)&&(b.setControlProp(E,x),t.stores.projectStore.commitTreeAndSend())}},c.controlKey);case"link":return m(P.type==="link"),m(D.type==="link"),(0,ee.jsx)(ql,{controlKey:v.id,control:P,controlProp:D,onChange:(x,E)=>{m(p.type==="link");let L=E(p);ge(L,p)||(b.setControlProp(x,L),t.stores.projectStore.commitTreeAndSend())}},c.controlKey);case"boolean":return m(P.type==="boolean"),m(D.type==="boolean"),(0,ee.jsx)(yr,{nodeIds:U,controlKey:v.id,control:P,controlProp:D,onChange:(x,E)=>{m(x.type==="boolean"),m(p.type==="boolean"),!ge(x,p)&&(b.setControlProp(E,x),t.stores.projectStore.commitTreeAndSend())}},c.controlKey);case"vectorsetitem":return m(P.type==="vectorsetitem"),m(D.type==="vectorsetitem"),(0,ee.jsx)(In,{controlKey:v.id,control:P,controlProp:D,onChange:(x,E)=>{m(x.type==="vectorsetitem"),m(p.type==="vectorsetitem"),!ge(x,p)&&(b.setControlProp(E,x),t.stores.projectStore.commitTreeAndSend())}},c.controlKey);default:po(p)}})})})})})}function Pm(r){let o=S.reactComponentForIdentifier(r.codeComponentIdentifier);return o?o.name:"Component"}var Dr=y(ie());var zn=y(I());function bd({tool:r}){let{nodeId:o,renderId:e}=r,t=F(),n=t.tree,i=(0,Dr.useRef)(null),a=Ce(),s=n.getNodeWithTrait(o,A);if($t(i,()=>{t.exitTool()}),(0,Dr.useEffect)(()=>(document.body.style.overflow="hidden",()=>{document.body.style.overflow="auto"})),!!s&&a)return(0,zn.jsx)(oe,{ref:i,tree:n,node:s,renderId:e,children:(0,zn.jsx)(yl,{tool:r,scopeNode:a,node:s,renderId:e,backdropEnabled:!0})})}var Sd=y(ie());var Wn=y(I());function Ed({tool:r}){let{nodeId:o,renderId:e}=r,t=F(),n=t.tree,i=(0,Sd.useRef)(null),a=Ce(),s=n.getNodeWithTrait(o,A);if($t(i,()=>{t.exitTool()}),!!s&&a)return(0,Wn.jsx)(oe,{ref:i,tree:n,node:s,renderId:e,children:(0,Wn.jsx)(hl,{tool:r,node:s,renderId:e,scopeNode:a})})}var Nt=y(ie());var me=y(I());function Nd(){let r=F(),o=T(()=>r.stores.treeStore.tree,[]),e=T(()=>r.stores.toolStore.highlightedRenderId,[]),t=T(()=>r.stores.mouseStore.lastUpdateType==="scroll",[]),n=T(()=>r.stores.mouseStore.isHoveringFloatingCanvasChrome,[]),i=Lt("onPageQuickAddRepeaterItems"),a=Pt(e),s=o.get(a),l=en(s),d=!Te(e),u=(0,Nt.useMemo)(()=>{if(!i||!s||!e)return null;if(Sr(r,s))return s;let b=s.ancestors();for(let v of b)if(Sr(r,v))return v;return null},[s,e,i]),g=l&&d,U=g&&!t&&Le.isHighlightableNode(r,s,e),c=g&&Le.isUnexpectedlyNonInteractiveNode(r,s,e),f=g&&!c&&!n&&Le.isInteractiveNode(r,s,e),w=!!u&&!t,p=bm({highlightedNode:s,highlightedRenderId:e,engine:r}),P=Em(s,e);return(0,me.jsxs)(me.Fragment,{children:[(0,me.jsx)(vm,{notAllowedCursor:c}),g&&(0,me.jsxs)(me.Fragment,{children:[f&&(0,me.jsx)(oe,{tree:o,node:s,renderId:e,className:J(Ar,!U&&fd,p),onMouseDown:P}),w&&(0,me.jsx)(Tm,{tree:o,highlightedRenderId:e,repeaterNode:u})]})]})}function vm(r){let o=F(),e=(0,Nt.useCallback)(()=>{o.stores.editableNodeHighlightStore.highlight(o,{type:"clickOnVoid"})},[]);return(0,me.jsx)("div",{"aria-hidden":!0,className:J(gd,r.notAllowedCursor&&ud),onClick:e})}function bm({highlightedNode:r,highlightedRenderId:o,engine:e}){let t=en(r),n=!Te(o);return!t||!n?Ln:we.supportsNode(e,r)||Fe.supportsNode(e,r,o)||Ve.supportsNode(e,r,o)?md:he.supportsNode(e,r)?pd:Ln}var Sm=r=>{switch(r){case"top":return hd;case"bottom":return Id;case"left":return Ud;case"right":return wd}};function Em(r,o){let e=F();return(0,Nt.useCallback)(()=>{!r||!o||(he.supportsNode(e,r)?e.startMoveTool(r.id,o,()=>{Td(e,r,o)||e.startHighlightTool()}):Td(e,r,o))},[r,o])}function Td(r,o,e){return je.supportsNode(r,o,e)?(r.startComponentInstanceEditTool(o.id,e),!0):_e.supportsNode(r,o,e)?(r.startDateVariableEditTool(o.id,e,"mouse"),!0):Ke.supportsNode(r,o,e)?(r.startImageEditTool(o.id,e),!0):we.supportsNode(r,o)?(r.startRichTextEditTool(o.id,e,"mouse"),!0):Fe.supportsNode(r,o,e)?(r.startRichTextVariableEditTool(o.id,e,"mouse"),!0):Ve.supportsNode(r,o,e)?(r.startStringVariableEditTool(o.id,e,"mouse"),!0):He.supportsNode(r,o,e)?(r.startCollectionReferenceVariableEditTool(o.id,e,"mouse"),!0):qe.supportsNode(r,o,e)?(r.startEnumVariableEditTool(o.id,e,"mouse"),!0):(r.stores.editableNodeHighlightStore.highlight(r,{type:"clickOnVoid"}),!1)}function Tm(r){let o=F(),{mouseStore:e}=o.stores,{tree:t,highlightedRenderId:n,repeaterNode:i}=r,a=T(()=>e.canvasMousePosition,[],Mi),s=(0,Nt.useMemo)(()=>{if(!i)return;let d=la(t,i);if(!d)return;let u=d.cache.domRects,g=null;for(let[U,c]of u??[])g=g?Re.merge(g,c):c;if(g)return g},[t,i]),l=(0,Nt.useMemo)(()=>{let d="bottom";if(!i)return d;let u=Hi(i)&&i.stackDirection==="horizontal"&&!i.stackWrapEnabled,g=t.convertFrameToCanvas(i,s,n);if(u){let b=g.x,v=b+g.width,D=window.scrollX,x=D+window.innerWidth,E=b>=D&&b<=x,L=v>=D&&v<=x;if(E&&!L)return"left";if(L&&!E)return"right";if(E&&L){let ue=a.x-b,re=v-a.x;return ue<re?"left":"right"}return"right"}let U=g.y,c=U+g.height,f=window.scrollY,w=f+window.innerHeight,p=U>=f&&U<=w,P=c>=f&&c<=w;if(p&&!P)return"top";if(P&&!p)return"bottom";if(p&&P){let b=a.y-U,v=c-a.y;return b<v?"top":"bottom"}return d},[i,n,s,a,t.convertFrameToCanvas]);return i?(0,me.jsx)(oe,{tree:t,node:i,renderId:n,className:Fd,overrideRect:s,children:(0,me.jsxs)("button",{type:"button",className:J(Cd,Sm(l)),onMouseDown:()=>Nm(o,i.id),[wn]:"true",children:[(0,me.jsx)(ka,{className:xd,children:(0,me.jsx)(Ea,{})}),(0,me.jsx)("div",{className:yd})]})}):null}function Nm(r,o){let{treeStore:e,projectStore:t,modalStore:n,accessStore:i}=r.stores,a=e.tree.getNodeWithTrait(o,on),s=on(a)&&ko(a)?oa(e.tree,a.dataIdentifier):void 0,l=i.access?.userId;m(l,"User must be logged in"),m(s,"Collection node must exist");let d=Go.create({isDraft:!0,privateToUserId:l});mr(s,d),e.tree.insertNode(d,s.id,0),t.commitTreeAndSend(),n.set({type:"OnPageCMSFieldsModal",fieldIdsToShow:Pr(s),requiredFieldsOnly:!1,source:"on_page_hud",collectionNodeId:s.id,collectionItemId:d.id})}var Pe=y(ie());var Ad="pqnmppj";var ze=y(I()),Dm=["right","left"],Bm={x:15,y:0};function Dd({tool:r}){let{nodeId:o,renderId:e}=r,[t,n]=(0,Pe.useState)(null),i=F(),a=T(()=>i.stores.treeStore.tree,[]),s=a.getNodeWithTrait(o,Ht);function l(){i.exitTool()}if(s)return(0,ze.jsx)(oe,{tree:a,node:s,renderId:e,ref:n,children:(0,ze.jsxs)($o,{anchor:t,alignSelf:"center",attachTo:Dm,offset:Bm,onClose:l,showArrow:!0,arrow:{anchor:t,alignSelf:"center"},fallbackToModalAppearance:!0,backdropTintEnabled:!1,children:[(0,ze.jsx)(qa,{disableDivider:!0,onClose:l,children:(0,ze.jsx)(Ka,{title:"Image"})}),(0,ze.jsx)("div",{className:Ad,children:We(s.fillImage)?(0,ze.jsx)(Rm,{node:s,dynamicValue:s.fillImage,renderId:e}):(0,ze.jsx)(Om,{node:s})})]})})}function Rm({node:r,dynamicValue:o,renderId:e}){return m(W(o),"Expected variable reference"),(0,ze.jsx)(km,{node:r,variableReference:o,renderId:e})}function km({node:r,variableReference:o,renderId:e}){let t=F(),n=T(()=>{let u=t.stores.treeStore,g=r.cache.getRenderInstance(e);return H(u.tree,u.sandboxCollectionData,o,"image",g?.collectionItemId)},[r,e,o]);m(n,"Variable info must exist");let{collectionItemNode:i,reducedControlProp:a,controlProp:s}=n;m(a.type==="responsiveimage","Expected reduced responsive image");let l=(0,Pe.useCallback)(u=>{i.set(rn({[o.id]:u(s)})),t.stores.projectStore.commitTreeAndSend()},[i,o,s]),d=(0,Pe.useCallback)(()=>{i.set(rn({[o.id]:{type:"image",value:void 0}})),t.stores.projectStore.commitTreeAndSend()},[i,o]);return(0,ze.jsx)(rl,{controlProp:a,onChange:l,onRemove:d,maxExtraImages:0})}function Om({node:r}){let o=F(),e=(0,Pe.useMemo)(()=>{let u={...Ls(),...Hs()};return zs(r,u),js(r,u),u},[r]),t=(0,Pe.useCallback)(async u=>{let[g]=await u;g&&(Es(r,g),o.stores.projectStore.commitTreeAndSend())},[r]),n=(0,Pe.useCallback)(u=>{_(r.fillImage)&&(r.set({fillImage:Di(r.fillImage,u)}),o.stores.projectStore.commitTreeAndSend())},[r]),i=(0,Pe.useCallback)(u=>{ca(r)&&(r.set({altAttribute:u}),o.stores.projectStore.commitTreeAndSend())},[r]),a=(0,Pe.useCallback)(u=>{r.set({fillImageResize:u}),o.stores.projectStore.commitTreeAndSend()},[r]),s=(0,Pe.useCallback)(u=>{r.set({fillImageTileSize:u}),o.stores.projectStore.commitTreeAndSend()},[r]),l=(0,Pe.useCallback)((u,g)=>{r.set({fillImagePositionX:u,fillImagePositionY:g}),o.stores.projectStore.commitTreeAndSend()},[r]),d=(0,Pe.useCallback)(()=>{r.set({fillImage:void 0}),o.stores.projectStore.commitTreeAndSend()},[r]);return(0,ze.jsx)(el,{...e,imageReferences:e.fillImages,altText:e.altAttribute,onChangeImages:t,onChangeAssetSize:n,onChangeAltText:i,onChangeImageResize:a,onChangeFillImageSize:s,onChangeImagePosition:l,onRemoveImage:d})}var Bd="g189l9ii",Rd="m1va6tk8";var Od=y(I());function kd({tool:r}){let o=F(),e=T(()=>r.hasMoved,[r]),t=T(()=>o.stores.treeStore.tree,[]),n=t.get(r.nodeId);if(!n)return null;let i=t.get(n.parentid);if(!i)return null;let s=n.cache.getRenderInstance(r.renderId)?.parentRenderId??i.id;return(0,Od.jsx)(oe,{tree:t,node:i,renderId:s,className:J(e&&Rd,e&&Bd)})}var Ld=y(ie());var Md="w1uyyr5z",Vd="w1z0oe1i";var vo=y(I());function zd({richTextNode:r,webPageNode:o}){let e=F(),t=T(()=>e.stores.treeStore.tree,[]);return(0,Ld.useMemo)(()=>{let i=t.getNodeWithTrait(r.getPrimaryId(),A);return m(i,"originalNode must exist"),o.getTopLevelReplicaVariants().some(a=>{let s=Io(a.id,i.id),l=t.get(s);return A(l)&&Ko(t,l,"html")&&l.getTextContent()!==i.getTextContent()})},[t,r,o])?(0,vo.jsxs)(Sa,{className:Md,onClick:()=>{e.exitTool(),e.stores.modalStore.set({richTextNodeId:r.id,source:"on_page_hud",type:"OnPageRichTextVariantOverride"})},children:[(0,vo.jsx)(Da,{viewBox:"0 0 12 12",className:Vd}),(0,vo.jsx)(ot,{children:"Responsive Text"})]}):null}var Wd="w1v62ead";var oo=y(I());function Hd({tool:r}){let{nodeId:o,renderId:e}=r,t=F(),n=T(()=>t.stores.treeStore.tree,[]),i=T(()=>t.stores.toolStore.editorOverlayClipPath,[]),a=T(()=>t.stores.toolStore.proseMirrorView,[]),s=n.getNodeWithTrait(o,A),l=Ce();return!s||!l||!a?null:(0,oo.jsxs)(oe,{tree:n,node:s,renderId:e,children:[(0,oo.jsx)("div",{className:Wd,children:(0,oo.jsx)(zd,{richTextNode:s,webPageNode:l})}),(0,oo.jsx)(Ul,{tool:r,scopeNode:l,node:s,renderId:e,editorView:a,zoom:1,handleOutsideClick:d=>{d.target===d.currentTarget&&t.exitTool()},style:{clipPath:i}})]})}var bo=y(I());function jd({tool:r}){let{nodeId:o,renderId:e}=r,t=F(),n=T(()=>t.stores.treeStore.tree,[]),i=T(()=>t.stores.toolStore.validationWarning,[]),a=T(()=>t.stores.toolStore.editorOverlayClipPath,[]),s=n.getNodeWithTrait(o,A),l=Ce();return!l||!s?null:(0,bo.jsxs)(oe,{tree:n,node:s,renderId:e,children:[(0,bo.jsx)(Tr,{validationWarning:i}),(0,bo.jsx)(wl,{tool:r,scopeNode:l,node:s,renderId:e,zoom:1,onClickOutside:d=>{d.target===d.currentTarget&&t.exitTool()},hasValidationWarning:!!i,style:{clipPath:a}})]})}var pe=y(I());function _d(){let r=F(),{sandboxStore:o}=r.stores,{canvasHeight:e}=o.useState(),t=T(()=>r.stores.treeStore.tree.getPresetsListNode(),[]);return(0,pe.jsxs)("div",{className:od,style:{height:e??"initial"},children:[(0,pe.jsx)(td,{}),(0,pe.jsx)(zm,{}),(0,pe.jsx)(Os,{presetsListNode:t})]})}function zm(){let r=F(),{projectStore:o,modalStore:e}=r.stores,t=T(()=>r.stores.toolStore.tool,[]),n=T(()=>r.stores.canvasStore.finishedEditing,[]),{hasPermanentlyFailed:i}=o.useState(),a=e.useState(s=>s.active.type!=="None");if(!i&&!n&&!a){if(t instanceof he)return(0,pe.jsx)(kd,{tool:t});if(t instanceof Le)return(0,pe.jsx)(Nd,{});if(t instanceof Ke)return(0,pe.jsx)(Dd,{tool:t});if(t instanceof we)return(0,pe.jsx)(Hd,{tool:t});if(t instanceof Fe)return(0,pe.jsx)(ld,{tool:t});if(t instanceof Ve)return(0,pe.jsx)(jd,{tool:t});if(t instanceof _e)return(0,pe.jsx)(bd,{tool:t});if(t instanceof He)return(0,pe.jsx)(ad,{tool:t});if(t instanceof qe)return(0,pe.jsx)(Ed,{tool:t});if(t instanceof je)return(0,pe.jsx)(vd,{tool:t})}}var Je=y(I());function qd(){Xt();let r=F(),o=T(()=>r.stores.canvasStore.isHidden,[]);return(0,Br.useEffect)(()=>{let e=({data:t})=>{if(mt(t)&&t.apiVersion===1){let{type:n,position:i}=t;n==="showCanvas"&&mt(i)&&go(i.top)&&(window.scrollTo({behavior:"instant",top:i.top}),setTimeout(()=>{r.stores.canvasStore.isHidden=!1,r.startHighlightTool(),r.stores.editableNodeHighlightStore.highlight(r,{type:"start"})},0))}};return window.addEventListener("message",e),()=>{window.removeEventListener("message",e)}},[]),(0,Br.useEffect)(()=>{let{sandboxStore:e}=r.stores;o?e.hide():e.show()},[o]),Wm(o),_l({channel:Si,toast:ut}),(0,Je.jsx)(Va,{children:(0,Je.jsxs)("div",{className:J(o&&Jl),children:[(0,Je.jsx)(_d,{}),(0,Je.jsxs)("div",{className:Ql,[Un]:"true",children:[(0,Je.jsx)(Yc,{}),(0,Je.jsx)(Lc,{}),(0,Je.jsx)(Xa,{padding:80}),(0,Je.jsx)(Hl,{ref:r.stores.projectStore.filePickerRef})]})]})})}function Wm(r){let o=F();(0,Br.useEffect)(()=>{if(r)return;let e=new Qs;e.set("CommandOrControl+Z",o.undo.bind(o),"undo"),e.set("CommandOrControl+Shift+Z",o.redo.bind(o),"redo");function t(n){if(sr())return;let i=e.get(n);i&&(Me("keyboard_shortcut",{shortcut:Js(n)}),i.action(n),n.preventDefault(),n.stopPropagation())}return window.addEventListener("keydown",t),()=>{window.removeEventListener("keydown",t)}},[r])}var Kd=y(ie());function Gd(){(0,Kd.useEffect)(()=>{let r=o=>{if(!mt(o.data))return;let{apiVersion:e,type:t}=o.data;e===1&&t==="enterOnPageEditing"&&Me("editor_bar_interaction",{page:"editor-bar-project-page",id:"editor-bar-enter-on-page-editing"})};return window.addEventListener("message",r),()=>window.removeEventListener("message",r)},[])}var Gn=y(ie());var ro="https://app.framerstatic.com/framer-logo-blue-UQOIW3P5.png";var kr="b9jl8lf",Or="eptse9g";var Yd="bzafg2a",$d="cnhgigm",Xd="t1ookr3o",Zd="tyol4w7",Jd="s7fryoi",Qd="by9jupw",ef="b18g1n4a",tf="c1gc3a0q";var no=y(I());function of({width:r=10,height:o=10,className:e}){return(0,no.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:r,height:o,fill:"none",className:e,"aria-hidden":"true",children:(0,no.jsxs)("g",{transform:"translate(2 2)",children:[(0,no.jsx)("path",{d:"M 0 0 L 6 6",fill:"transparent",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round"}),(0,no.jsx)("path",{d:"M 0 6 L 6 0",fill:"transparent",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round"})]})})}var ve=y(I());function _m({children:r,onClick:o,disabled:e,layoutId:t,duration:n}){return(0,ve.jsx)($e.div,{layout:"position",layoutId:t,style:{width:"100%"},transition:{duration:n,type:"spring",bounce:.2,delay:0},children:(0,ve.jsx)(Y,{type:"button",className:Qd,onClick:o,enabled:!e,children:r})})}function io({logo:r,title:o,subtitle:e,buttons:t,showLearnMoreButton:n}){let i=()=>{window.open("https://www.framer.com/help/articles/on-page-editing","_blank")},a=()=>{window.parent.postMessage({apiVersion:1,type:"sandboxReadyState",data:{status:"ready"}},"*"),window.parent.postMessage({apiVersion:1,type:"exitFullscreen",position:{top:window.scrollY}},"*")};return(0,ve.jsx)(Ne,{className:Yd,onClick:a,children:(0,ve.jsxs)(Ne,{className:$d,justifyContent:"center",alignItems:"center",onClick:s=>s.stopPropagation(),children:[(0,ve.jsx)(Ne,{onClick:a,className:tf,children:(0,ve.jsx)(of,{})}),(0,ve.jsxs)(Ne,{className:Xd,gap:15,alignItems:"center",justifyContent:"center",children:[r,(0,ve.jsxs)(Ne,{gap:5,alignItems:"center",justifyContent:"center",children:[(0,ve.jsx)($e.span,{layout:!0,className:Zd,children:o}),(0,ve.jsx)($e.p,{layout:!0,className:Jd,children:e})]})]}),t||n?(0,ve.jsxs)(Ne,{className:ef,gap:10,children:[n?(0,ve.jsx)(_m,{onClick:i,children:"Learn More"}):null,t||null]}):null]})})}var Mr=y(I());function rf(){let r=F();Yt("editor_bar_impression",{page:"editor-bar-cookie-prompt"});async function o(){Me("editor_bar_interaction",{page:"editor-bar-cookie-prompt",id:"editor-bar-allow-cookies"});try{await document.requestStorageAccess()}finally{await r.stores.accessStore.refresh()}}return(0,Mr.jsx)(io,{logo:(0,Mr.jsx)("img",{decoding:"async",width:36,src:ro,alt:"Framer Logo"}),title:"Edit Page",subtitle:"Continuing may require granting permissions in a browser dialog.",buttons:(0,Mr.jsx)(Y,{className:J(kr,Or),onClick:o,variant:"primary",children:"Continue"}),showLearnMoreButton:!0})}var _n=y(I());function nf({children:r,onClick:o,disabled:e,layoutId:t,duration:n,className:i}){return(0,_n.jsx)($e.div,{layout:"position",layoutId:t,style:{width:"100%"},transition:{duration:n,type:"spring",bounce:.2,delay:0},children:(0,_n.jsx)(Y,{type:"button",className:J(kr,i),onClick:o,enabled:!e,children:r})})}var af="l4nhz4u";var ao=y(I());function sf(){let r=F(),{isLoginInProgress:o}=r.stores.loginStore.useState();Yt("editor_bar_impression",{page:"editor-bar-guest-page"});async function e(){Me("editor_bar_interaction",{page:"editor-bar-guest-page",id:"editor-bar-login"}),await r.stores.loginStore.login()}return(0,ao.jsx)(io,{logo:(0,ao.jsx)("img",{decoding:"async",width:36,height:36,src:ro,alt:"Framer Logo"}),title:"Edit Page",subtitle:"Edit the page directly in the browser, without opening the app.",buttons:(0,ao.jsx)(nf,{onClick:e,disabled:o,className:Or,children:o?(0,ao.jsx)("div",{className:af,children:(0,ao.jsx)(Wl,{})}):"Continue"}),showLearnMoreButton:!0})}var qn=y(I()),Km="Page Edit",Gm="To edit, ask the site owner for access to the project",Ym="To edit, ask the site owner for content editing permissions";function Kn({reason:r}){return Yt("editor_bar_impression",{page:"editor-bar-no-access-page"}),(0,qn.jsx)(io,{logo:(0,qn.jsx)("img",{decoding:"async",width:36,src:ro,alt:"Framer Logo"}),title:Km,subtitle:r==="no-permission"?Ym:Gm,showLearnMoreButton:!0})}var So=y(I());function lf(){let r=F(),{access:o}=r.stores.accessStore.useState();switch(o.status){case"no-auth":return(0,So.jsx)(sf,{});case"unknown":return(0,So.jsx)(rf,{});case"no-access":return(0,So.jsx)(Kn,{reason:"no-access"});case"no-permission":return(0,So.jsx)(Kn,{reason:"no-permission"});case"success":case"error":return null;default:po(o)}}var At=y(I());function cf(){let r=F(),{shouldRenderOnPageCanvas:o}=r.stores.accessStore.useState(),e=nt(()=>r.stores.routeStore.webPageNodeId,[],[r.stores.routeStore]);return(0,Gn.useEffect)(()=>{e&&r.stores.sandboxStore.waitForInitialLoad(e).then(()=>{window.parent.postMessage({apiVersion:1,type:"sandboxReadyState",data:{status:"ready"}},"*")}).catch(de)},[e]),(0,Gn.useEffect)(()=>{r.performanceTracker.reportEditorBarReady()}),Gd(),(0,At.jsxs)(At.Fragment,{children:[(0,At.jsx)(lf,{}),o&&(0,At.jsx)(qd,{})]})}var df=y(ie());var mf=y(I());function ff(){let r=F(),o=(0,df.useCallback)(()=>{r.stores.contextMenuStore.close()},[]);return(0,mf.jsx)(Cl,{environment:"onPage",menu:r.stores.contextMenuStore.menu,onClose:o})}var Vr=class{constructor(o){this.engine=o;h(this,"state",0);h(this,"changes",new xa)}get inRendering(){return this.state===3}render(){if(this.state!==1)return;let o=this.changes,e=this.engine.stores;try{this.state=2,o.has(e.treeStore,e.routeStore)&&Zo(e.treeStore.tree,e.treeStore.layoutCache,e.treeStore.sandboxCollectionData,e.treeStore.sandboxVisibility,S.activeBundleHash,e.routeStore.localeId,void 0,e.routeStore.webPageNodeId),e.toolStore.tool?.update?.(),e.undoRedoManager.processScheduledEndUndoGroup({}),this.state=3,e.sandboxStore.update(),o.signalAllObservers(),il()}finally{this.state=0}}signalChanges(o){if(this.changes.addChanges(o),this.state!==0)return;this.state=1;let e=this.render.bind(this);setTimeout(e,0),nl()}wrapHandler(o,e){let{projectStore:t}=this.engine.stores;return function(...n){let i=o.apply(this,n);return t.commitTreeAndSend(e!=="nonUserEvent"),i}}process(o,e){this.wrapHandler(o,e)()}processWhenReady(o,e){this.wrapHandler(o,e)()}async processWhenReadyAsync(o,e){return this.wrapHandler(o,e)()}runWhenIdle(o){requestIdleCallback(o)}runWithFullyLoadedTree(o,e){m(e.runInBackground,"Only background tasks are supported in the OnPageEngine for now.");let t=this.engine.tree.getService("loader"),n=()=>{o(),this.engine.stores.projectStore.commitTreeAndSend()};if(!t)return n(),gt;let i=t.prioritizeLoadingAllData({operationName:e.name,operationInBackground:!0,doNotTrack:e.doNotTrack}),a=t.afterAllDataLoaded(n);return()=>{i(),a()}}runBeforeNextFrame(o){requestAnimationFrame(o)}scheduleDocumentUpdateIgnoringUndo(o){throw new Error("Not implemented")}};var Lr=class extends Oe{constructor(e,t,n){super();this.projectStore=e;this.hostnameStore=t;this.siteId=n;h(this,"_access")}get access(){return m(this._access,"Access not initialized"),this._access}get projectId(){return pf(this.access)}get canEditContent(){let e=this.access;return e.status!=="success"?!1:e.data.permissions?.canEditContent==="on"}get shouldRenderOnPageCanvas(){return Cn()&&this.canEditContent}async set(e){if(this._access=e,this.shouldRenderOnPageCanvas){let t=pf(e);e.userId&&t&&(this.projectStore.loadProject(e.userId,t),this.hostnameStore.loadHostnames(t).catch(de))}ma.setUserId(e.userId??"null")}async refresh(){let e=await jl(this.siteId);await this.set(e)}},$m=/^(?<name>.+--)?(?<id>[a-z0-9]{20})(?<hash>-[a-z0-9]+)?$/iu;function pf(r){if(r.status==="success")return $m.exec(r.data.projectSlug)?.groups?.id}var uf,gf,Dt,Yn,$n;gf=[k()],uf=[k()];var Bt=class{constructor(o){this.scheduler=o;R(this,Yn,C(Dt,8,this,[])),C(Dt,11,this);R(this,$n,C(Dt,12,this)),C(Dt,15,this);h(this,"assetMap",new Ni)}get assets(){return this._assets}get assetService(){return this._assetService}setAssetService(o){this._assetService=o,Ai(o,e=>{e.assets&&(this._assets=e.assets,this.assetMap.set(e.assets),ft.importCustomFonts(this.assetMap.items(),Ie.isOn("customFontGrouping")))})}};Dt=ae(null),Yn=new WeakMap,$n=new WeakMap,N(Dt,4,"_assets",gf,Bt,Yn),N(Dt,4,"_assetService",uf,Bt,$n),se(Dt,Bt);async function yf(r){return Za.post("/edit/notifications/page-edited",r)}var hf,If,Uf,wf,De,Xn,Zn,Jn,Qn;wf=[k()],Uf=[k()],If=[k()],hf=[k()];var ct=class{constructor(o,e,t,n,i,a,s,l,d){this.scheduler=o;this.accessStore=e;this.routeStore=t;this.treeStore=n;this.projectStore=i;this.modalStore=a;this.undoRedoManager=s;this.exitTool=l;this.onChangeRoute=d;R(this,Xn,C(De,8,this,!0)),C(De,11,this);R(this,Zn,C(De,12,this,null)),C(De,15,this);R(this,Jn,C(De,16,this,window.innerWidth)),C(De,19,this);R(this,Qn,C(De,20,this)),C(De,23,this);window.addEventListener("resize",()=>{this._screenWidth=window.innerWidth})}get screenWidth(){return this._screenWidth}get temporaryCollectionItemNodeId(){return this._temporaryCollectionItemNodeId}set temporaryCollectionItemNodeId(o){this._temporaryCollectionItemNodeId=o,this.onChangeRoute()}async sendNotification(o){let e=this.accessStore.projectId;m(e,"Project ID must exist");let t=at({tree:this.treeStore.tree,webPageNodeId:this.routeStore.webPageNodeId});m(t,"Web page node must exist");let n=Ze(this.routeStore,this.treeStore,this),i;if(n){let a=Zt(this.routeStore,this.treeStore,this);m(a,"Collection item exists, so its parent collection must exist");let s=a.resolveValue("name");m(s,"Collection node must have a name"),i={notificationType:o,projectId:e,webPageNodeId:t.id,collectionItemNodeId:n.id,collectionItemTitle:Xm(a,n),collectionTitle:s,pageType:"cms-detail"}}else i={notificationType:o,projectId:e,webPageNodeId:t.id,pageTitle:t.webMetadata?.title||rs(this.treeStore.tree,t),pageType:"static"};await yf(i)}createTemporaryCollectionItem(){let o=Zt(this.routeStore,this.treeStore,this);if(!o)return;let e=this.accessStore.access?.userId;m(e,"User must be logged in");let t=o.getPrivateItemForUser(e);if(t)this.temporaryCollectionItemNodeId=t.id;else{let n=Go.create({isDraft:!0,privateToUserId:e});this.treeStore.tree.insertNode(n,o.id,0),this.temporaryCollectionItemNodeId=n.id,mr(o,n),this.projectStore.commitTreeAndSend()}}discardTemporaryCollectionItem(){let o=Ze(this.routeStore,this.treeStore,this);m(o,"Collection item node must exist"),m(o.id===this.temporaryCollectionItemNodeId,"Collection item must be temporary"),this.treeStore.tree.remove(o.id),this.projectStore.commitTreeAndSend(),this.clearTemporaryItem(),this.exitFullscreen()}saveTemporaryCollectionItem(){let o=Ze(this.routeStore,this.treeStore,this);m(o,"Collection item node must exist"),m(o.id===this.temporaryCollectionItemNodeId,"Collection item must be temporary"),o?.set({privateToUserId:void 0}),this.projectStore.commitTreeAndSend(),this.finishEditingWithChanges(o.id,!0)}handleFinishEditing(){this.exitTool();let o=Ze(this.routeStore,this.treeStore,this);if(!!!o?.privateToUserId){if(!this.treeStore.hasChanged()){this.handleDismissFinishEditing();return}let l=this.routeStore.projectLinkNodeId;if(!l)return;this.finishEditingWithChanges(l,!1);return}let t=Zt(this.routeStore,this.treeStore,this);if(m(t&&o,"Collection node and collection item node must exist"),!o.hasData()){this.discardTemporaryCollectionItem();return}let n=lr(t,o);$s(t,o,n)&&this.projectStore.commitTreeAndSend();let s=Ys(this.treeStore.tree,t,o,n).flatMap(l=>{let d=l.type;return On[d]!==void 0?l.id:[]});s.length>0?this.modalStore.set({type:"OnPageCMSFieldsModal",fieldIdsToShow:s,requiredFieldsOnly:!0,source:"on_page_hud",collectionItemId:o.id,collectionNodeId:t.id}):this.saveTemporaryCollectionItem()}finishEditingWithChanges(o,e){this.finishedEditing={isNewItem:e,nodeId:o},Me("editor_bar_interaction",{page:"editor-bar-project-page",id:"editor-bar-finish-editing-with-changes"});let t=e?"page-created":"page-edited";this.sendNotification(t).catch(de)}handleDismissFinishEditing(){this.clearTemporaryItem(),this.undoRedoManager.clearUndoStack(),this.exitFullscreen()}exitFullscreen(){window.parent.postMessage({apiVersion:1,type:"exitFullscreen",position:{top:window.scrollY}},"*"),this.isHidden=!0}clearTemporaryItem(){this.finishedEditing=null,this.temporaryCollectionItemNodeId=void 0}};De=ae(null),Xn=new WeakMap,Zn=new WeakMap,Jn=new WeakMap,Qn=new WeakMap,N(De,4,"isHidden",wf,ct,Xn),N(De,4,"finishedEditing",Uf,ct,Zn),N(De,4,"_screenWidth",If,ct,Jn),N(De,4,"_temporaryCollectionItemNodeId",hf,ct,Qn),se(De,ct);function Xm(r,o){let e=r.getSlugVariable();if(e?.associatedStringVariable){let t=o.getControlProp(e.associatedStringVariable);if(t&&t.type==="string"&&_(t.value)&&t.value.trim())return t.value.trim()}return"a new page"}var zr=class{updateComponentLoader(o,e){S.setModuleRevision(e,0);for(let t of o)S.updateEntity(t.identifier,t)}};var Zm=0,Cf,Wr,ei,lo;Cf=[k()];var so=class{constructor(o){this.scheduler=o;R(this,ei,C(Wr,8,this)),C(Wr,11,this);R(this,lo);window.addEventListener("resize",()=>{this._editableNodesHighlight&&(this._editableNodesHighlight=void 0)})}get editableNodesHighlight(){return this._editableNodesHighlight}onChangeRoute(){this._editableNodesHighlight&&(this._editableNodesHighlight=void 0)}cleanupAnimationOnFinish(o){Mt(this,lo)&&clearTimeout(Mt(this,lo)),To(this,lo,window.setTimeout(()=>{this._editableNodesHighlight=void 0},o+100))}highlight(o,{type:e}){let t=ye({screenWidth:o.stores.canvasStore.screenWidth,tree:o.stores.treeStore.tree,webPageNodeId:o.stores.routeStore.webPageNodeId});if(!t)return;let n=[],i={x:0,y:window.scrollY,width:window.innerWidth,height:window.innerHeight},a=1/0,s=-1/0,l=!1;for(let d of t.walk())for(let[u]of d.cache.iterateRenderInstances()){if(!Le.isHighlightableNode(o,d,u))continue;l=!0;let g=o.tree.convertFrameToCanvas(d,void 0,u);if(!Jm(i,g))continue;a=Math.min(a,g.y),s=Math.max(s,g.y+g.height);let U=o.tree.getRect(d,void 0,void 0,void 0,u),c=o.tree.transformMatrixToNode(d,void 0,void 0,u);n.push({renderId:u,width:U.width,height:U.height,transform:c.toString(),centerX:g.x+g.width/2,centerY:g.y+g.height/2})}if(n.length===0)ut({key:"editable-nodes-highlight-empty",type:"add",text:l?"Editable content is out of view, scroll to reveal it":"Content is not editable on this page",variant:"info"}),this._editableNodesHighlight=void 0;else{let d=e==="clickOnVoid",u=d?o.stores.mouseStore.windowMousePosition.x:i.width,g=d?o.stores.mouseStore.windowMousePosition.y:i.height/2,U=d?o.stores.mouseStore.canvasMousePosition.y:o.stores.mouseStore.scrollPosition.y,c=400,f=Math.max(u,window.innerWidth-u),w=Math.max(g,window.innerHeight-g),p=Math.sqrt(f**2+w**2)+c,P=Math.max(500,e==="clickOnVoid"?p:p*2),b=5,v=Math.max(0,Math.floor(a-b)),D=Math.ceil(s+b),x=Qm(n,p,u,U);this._editableNodesHighlight={animationId:`editable-nodes-highlight-${Zm++}`,minY:v,maxY:D,originX:u,originY:g-v+i.y,highlights:n,minRadius:x,maxRadius:p,gradientSize:c,animationDuration:P},this.cleanupAnimationOnFinish(P)}}};Wr=ae(null),ei=new WeakMap,lo=new WeakMap,N(Wr,4,"_editableNodesHighlight",Cf,so,ei),se(Wr,so);function Jm(r,o){return!(o.x>=Re.maxX(r)||Re.maxX(o)<=r.x||o.y>=Re.maxY(r)||Re.maxY(o)<=r.y)}function Qm(r,o,e,t){let n=1/0;for(let i of r){let a=Math.sqrt(i.width**2+i.height**2),s=Math.abs(i.centerX-e),l=Math.abs(i.centerY-t),d=Math.sqrt(s**2+l**2),u=Math.max(0,d-a/2);n=Math.min(n,u)}return Number.isFinite(n)&&n<o?n:0}var Hr=class extends Ss{constructor(){super(...arguments);h(this,"hostnames");h(this,"testing",{setHostnames:e=>{this.hostnames=e}})}get customHostnameString(){return this.hostnames?.find(e=>e.type==="custom")?.hostname}get defaultHostnameString(){return this.hostnames?.find(e=>e.type==="default")?.hostname}async loadHostnames(e){let{hostnames:t}=await bs(e);this.hostnames=t}};var jr=class extends Oe{constructor(e){super();this.sandboxStore=e}async ensureModuleEvaluatedInSandbox(e){return(await this.sandboxStore.getModulesRuntime()).loadModule(e.value)}hasModuleForIdentifier(e){return!!S.componentForIdentifier(e.value)}};var _r=class extends Oe{constructor(e){super();this.accessStore=e;h(this,"isLoginInProgress",!1)}login(){let e=window.open(`${Do().login}?closeAfterSuccess=true`,"_blank");return e?this.startLoginWindowClosedPolling(e):Promise.resolve()}startLoginWindowClosedPolling(e){return this.isLoginInProgress=!0,new Promise(n=>{let i=setInterval(async()=>{e.closed&&(clearInterval(i),await this.accessStore.refresh(),this.isLoginInProgress=!1,n())},500)})}};var xf,Ff,Pf,vf,bf,Sf,Ef,Tf,Nf,j,ti,oi,ri,ni,ii,ai,si,li;Nf=[k()],Tf=[k(le.isEqual)],Ef=[k(le.isEqual)],Sf=[k()],bf=[St(le.isEqual)],vf=[k()],Pf=[k()],Ff=[k()],xf=[k()];var be=class{constructor(o){this.scheduler=o;C(j,5,this);R(this,ti,C(j,8,this)),C(j,11,this);R(this,oi,C(j,12,this,le(0,0))),C(j,15,this);R(this,ri,C(j,16,this,le(0,0))),C(j,19,this);R(this,ni,C(j,20,this,!1)),C(j,23,this);R(this,ii,C(j,24,this,!1)),C(j,27,this);R(this,ai,C(j,28,this,!1)),C(j,31,this);R(this,si,C(j,32,this,{canvasMousePosition:le(0,0),windowMousePosition:le(0,0)})),C(j,35,this);R(this,li,C(j,36,this,{canvasMousePosition:le(0,0),windowMousePosition:le(0,0)})),C(j,39,this);let e=this.onMouseMove.bind(this);document.addEventListener("mousemove",e);let t=this.onScroll.bind(this);document.addEventListener("scroll",t);let n=this.onMouseDown.bind(this);document.addEventListener("mousedown",n);let i=this.onMouseUp.bind(this);document.addEventListener("mouseup",i)}get lastUpdateType(){return this._lastUpdateType}get scrollPosition(){return this._scrollPosition}get windowMousePosition(){return this._windowMousePosition}get isMouseDown(){return this._isMouseDown}get canvasMousePosition(){return le.add(this.windowMousePosition,this.scrollPosition)}get isHoveringChrome(){return this._isHoveringChrome}get isHoveringFloatingCanvasChrome(){return this._isHoveringFloatingCanvasChrome}get latest(){return this._latest}get previous(){return this._previous}updateInputState(){this._previous={canvasMousePosition:this._latest.canvasMousePosition,windowMousePosition:this._latest.windowMousePosition},this._latest={canvasMousePosition:this.canvasMousePosition,windowMousePosition:this.windowMousePosition}}onScroll(){this._scrollPosition=le(window.scrollX,window.scrollY),this._lastUpdateType="scroll",this.updateInputState()}onMouseMove(o){this._isHoveringChrome=$l(o.target),this._isHoveringFloatingCanvasChrome=Xl(o.target),this._windowMousePosition=le(o.clientX,o.clientY),this._lastUpdateType="mouseMove",this.updateInputState()}onMouseDown(o){this._isMouseDown=!0,this._lastUpdateType="mouseDown",this.updateInputState()}onMouseUp(){this._isMouseDown=!1,this._lastUpdateType="mouseUp",this.updateInputState()}};j=ae(null),ti=new WeakMap,oi=new WeakMap,ri=new WeakMap,ni=new WeakMap,ii=new WeakMap,ai=new WeakMap,si=new WeakMap,li=new WeakMap,N(j,4,"_lastUpdateType",Nf,be,ti),N(j,4,"_scrollPosition",Tf,be,oi),N(j,4,"_windowMousePosition",Ef,be,ri),N(j,4,"_isMouseDown",Sf,be,ni),N(j,2,"canvasMousePosition",bf,be),N(j,4,"_isHoveringChrome",vf,be,ii),N(j,4,"_isHoveringFloatingCanvasChrome",Pf,be,ai),N(j,4,"_latest",Ff,be,si),N(j,4,"_previous",xf,be,li),se(j,be);var qr=class extends Oe{constructor(){super(...arguments);h(this,"colorModel","HEX")}};var Af=y(ie());var Kr=class extends Oe{constructor(e,t){super();this.assetStore=e;this.treeStore=t;h(this,"_hasPermanentlyFailed",!1);h(this,"project");h(this,"projectPromise",new Vt);h(this,"filePickerRef",(0,Af.createRef)())}get hasPermanentlyFailed(){return this._hasPermanentlyFailed}getProject(){return this.projectPromise}get resourceLimits(){}get featureFlags(){}get projectLicenseType(){return"freeSite"}loadProject(e,t){Xt(),!this.project&&(this.project=new Kl(this.treeStore.timeline,e,t),this.project.connect(),this.project.on("disconnect",this.onDisconnect,this),this.project.connection.on("disconnect",this.onDisconnect,this),this.project.on("update",n=>{this.treeStore.newTreeAfterRemoteUpdate(n)}),this.assetStore.setAssetService(this.project.assetService),this.projectPromise.resolve(this.project))}onDisconnect(e){As(e)||(this._hasPermanentlyFailed=!0,e==="ClientNeedsUpdate"?ut({type:"add",variant:"warning",text:"A new version of Framer is available. Please reload the page to continue working.",key:"client-outdated",duration:1/0,icon:"warning",showCloseButton:"never"}):e==="Maintenance"?ut({type:"add",variant:"warning",text:"Framer is undergoing maintenance. Please reload to continue once we\u2019re back.",key:"maintenance-mode",duration:1/0,icon:"warning",showCloseButton:"never",action:{title:"Reload",onClick:()=>window.location.reload()}}):ut({type:"add",variant:"error",text:"Connection error: "+e,key:"connection-error",duration:1/0,icon:"error",showCloseButton:"never"}))}commitTreeAndSend(e=!0){m(this.project,"Project must be initialized"),m(!this.hasPermanentlyFailed,"Project is permanently failed");let t=this.treeStore.timeline.commitLocalTree();this.treeStore.newTreeAfterLocalUpdate(t,e),this.project.maybeSend()}};var Df,Bf,Rf,Qe,ci,di,fi;Rf=[k()],Bf=[k()],Df=[k()];var It=class{constructor(o,e){this.scheduler=o;this.onChangeRoute=e;R(this,ci,C(Qe,8,this)),C(Qe,11,this);R(this,di,C(Qe,12,this)),C(Qe,15,this);R(this,fi,C(Qe,16,this,ce)),C(Qe,19,this);let t=({data:n})=>{if(mt(n)&&n.apiVersion===1){let{type:i,nodeIds:a}=n;if(i==="updateNodeIds"&&mt(a)){let{webPageNodeId:s,collectionItemNodeId:l,activeLocaleId:d}=a;this._webPageNodeId=_(s)?s:void 0,this._collectionItemNodeId=_(l)?l:void 0,this.localeId=_(d)&&st("onPageLocalizationSupport")?d:ce,this.onChangeRoute()}}};window.addEventListener("message",t),window.parent.postMessage({apiVersion:1,type:"initializeComponent",component:"OnPageActiveRouteStore"},"*")}get collectionItemNodeId(){return this._collectionItemNodeId}get webPageNodeId(){return this._webPageNodeId}get projectLinkNodeId(){return this._collectionItemNodeId??this._webPageNodeId}};Qe=ae(null),ci=new WeakMap,di=new WeakMap,fi=new WeakMap,N(Qe,4,"_collectionItemNodeId",Rf,It,ci),N(Qe,4,"_webPageNodeId",Bf,It,di),N(Qe,4,"localeId",Df,It,fi),se(Qe,It);var kf="icxp2h1";var Gr=class extends Oe{constructor(e,t,n,i){super();this.componentsStore=e;this.treeStore=t;this.performanceTracker=n;this.updateGenerator=i;h(this,"config",cl.onPageCanvas);h(this,"iframe");h(this,"remoteSandbox");h(this,"remoteControlsVisibility",new Vt);h(this,"remoteModulesRuntime",new Vt);h(this,"_canvasHeight");h(this,"webPageNodeIdToInitialLoadPromise",new Map);window.addEventListener("scroll",()=>{this.remoteSandbox?.scrollTo({behavior:"instant",top:window.scrollY})})}getControlsVisibility(){return this.remoteControlsVisibility}getModulesRuntime(){return this.remoteModulesRuntime}get canvasHeight(){return this._canvasHeight}loadSandbox(){Xt(),m(!this.iframe,"Sandbox already loaded");let e=document.createElement("iframe");e.src=this.config.url,e.allow=al,e.sandbox.add("allow-scripts","allow-same-origin"),e.tabIndex=-1,e.id="canvas_sandbox",e.className=kf;let t=this.initializeSandbox.bind(this,e);e.addEventListener("load",t),this.iframe=e,this.hide(),document.body.append(e)}getInitialLoadPromise(e){let t=this.webPageNodeIdToInitialLoadPromise.get(e)??new Vt;return this.webPageNodeIdToInitialLoadPromise.set(e,t),t}async waitForInitialLoad(e){this.performanceTracker.reportCanvasLoaderViewed(),await this.getInitialLoadPromise(e)}async initializeSandbox(e){let t=e.contentWindow;m(t,"Sandbox didn't load correctly");let n=new sl(it);n.setLocal(it.channels.componentsStore,this.componentsStore),n.setLocal(it.channels.sandboxStore,this),n.setLocal(it.channels.treeStore,this.treeStore);let i=n.getRemote(it.channels.sandbox),a=n.getRemote(it.channels.controlsVisibility),s=n.getRemote(it.channels.modulesRuntime),l=n.getRemote(it.channels.flags);await n.connect({target:t,url:this.config.origin}),this.remoteSandbox=i,this.remoteControlsVisibility.resolve(a),this.remoteModulesRuntime.resolve(s),new ll(l)}onHeightChange(e){this._canvasHeight=e}onInitialLoadComplete(e){this.performanceTracker.reportCanvasReady(),this.getInitialLoadPromise(e).resolve()}update(){let e=this.remoteSandbox;if(!e)return;let t=this.updateGenerator.getUpdate();Ao(t)||e.update(t)}hide(){m(this.iframe,"Sandbox not loaded"),this.iframe.setAttribute("aria-hidden","true")}show(){m(this.iframe,"Sandbox not loaded"),this.iframe.removeAttribute("aria-hidden")}};var Of,mi;Of=[St()];var co=class{constructor(o,e,t){this.scheduler=o;this.routeStore=e;this.treeStore=t;C(mi,5,this)}get active(){let o=at({tree:this.treeStore.tree,webPageNodeId:this.routeStore.webPageNodeId});return V(o,"webPageNode must be defined"),o}};mi=ae(null),N(mi,2,"active",Of,co),se(mi,co);function Mf({editorNode:r,screenWidth:o,tree:e,webPageNodeId:t,windowMousePositionOnToolEntry:n}){let i=ye({screenWidth:o,tree:e,webPageNodeId:t});if(!i)return;let a=e.convertFrameToCanvas(r),s=e.getNodesInRect(i,a,!0),l=[],d=i.cache.layoutTemplateRects;if(d)for(let[b,v]of d)!v.canvasRect||!Re.intersects(v.canvasRect,a)||l.push(new da({zIndex:v.domRect.zIndex,id:b,parentid:i.id}));let u=s.concat(l),g=Yo(u,e,{[i.id]:l}),U=g.findIndex(b=>b.id===r.id);if(U===-1)return;let c=g.slice(U+1);if(c.length===0)return;let w=e.transformMatrixToNode(r).inverse(),p=n?{x:n.x+window.scrollX,y:n.y+window.scrollY,width:1,height:1}:void 0,P=[];for(let b of c){let v=d?.get(b.id),D=e.convertFrameToCanvas(b);if(p&&Re.intersects(p,D))continue;let x;if(v?.canvasCorners?x=v.canvasCorners:x=e.convertCornerPointsToCanvas(b),x.length===0)continue;let E=[];for(let{x:L,y:ue}of x){let re=new DOMPoint(L,ue).matrixTransform(w);E.push({x:re.x,y:re.y})}E.length!==0&&P.push(E)}if(P.length!==0)return{editorRect:a,polygons:P}}function Vf({editorRect:r,polygons:o}){let e=`M ${-Ut},${-Ut} L ${-Ut},${r.height+Ut} L ${r.width+Ut},${r.height+Ut} L ${r.width+Ut},${-Ut} Z`;for(let t of o){let n=t[0];if(!n)continue;let i=[...t,n];for(let a of i)e+=` L ${a.x},${a.y}`;e+=" Z"}return`path("${e}")`}function Lf(r){let o=[];for(let e of r){if(e.length===0)continue;let[t,...n]=e;if(!t)continue;let i=`M ${t.x},${t.y}`;for(let a of n)i+=` L ${a.x},${a.y}`;i+=" Z",o.push(i)}if(o.length!==0)return`path("${o.join(" ")}")`}var Ut=100;var zf,Wf,Hf,jf,_f,qf,Kf,Gf,te,pi,ui,gi,yi,hi,fo,Ii;Gf=[k()],Kf=[k()],qf=[k()],_f=[k()],jf=[k()],Hf=[k()],Wf=[St()],zf=[St()];var Be=class{constructor(o,e,t,n,i){this.scheduler=o;this.treeStore=e;this.routeStore=t;this.canvasStore=n;this.mouseStore=i;C(te,5,this);R(this,pi,C(te,8,this)),C(te,11,this);R(this,ui,C(te,12,this,tn)),C(te,15,this);R(this,gi,C(te,16,this)),C(te,19,this);R(this,yi,C(te,20,this,null)),C(te,23,this);R(this,hi,C(te,24,this)),C(te,27,this);R(this,fo);R(this,Ii,C(te,28,this)),C(te,31,this)}get tool(){return this._tool}set tool(o){To(this,fo,this.mouseStore.windowMousePosition),this._tool!==o&&(this._tool?.stop?.(),this._tool=o)}get windowMousePositionOnToolEntry(){return Mt(this,fo)}get editorClipGeometryEntry(){let o=this.nodeInTextEditorId;if(!o||o===tn)return null;let e=Pt(o),t=this.treeStore.tree.get(e);if(!t)return null;let n=Mf({domLayoutUpdate:this.treeStore.domLayoutUpdate,editorNode:t,screenWidth:this.canvasStore.screenWidth,tree:this.treeStore.tree,webPageNodeId:this.routeStore.webPageNodeId,windowMousePositionOnToolEntry:Mt(this,fo)});return n?{nodeId:e,geometry:n}:null}get editorOverlayClipPath(){let o=this.editorClipGeometryEntry;if(o)return Vf(o.geometry)}get sandboxNodeInTextEditorClipPath(){let o=this.editorClipGeometryEntry;if(o)return Lf(o.geometry.polygons)}validateCollectionControl(o){let e="required";if(!o)return;let{collectionItemNode:t,variableDefinition:n,collectionNode:i,controlDescription:a,controlProp:s}=o,l;(Mo(n)||ho(n))&&(l=cr(n,i.variables,t));let d=lr(i,t),u=n.type,g=dr(u,a,s,l,void 0,Vo(n),d.get(n.id));this.validationWarning=g?.type===e?void 0:g}};te=ae(null),pi=new WeakMap,ui=new WeakMap,gi=new WeakMap,yi=new WeakMap,hi=new WeakMap,fo=new WeakMap,Ii=new WeakMap,N(te,4,"highlightedRenderId",Gf,Be,pi),N(te,4,"nodeInTextEditorId",Kf,Be,ui),N(te,4,"proseMirror",qf,Be,gi),N(te,4,"proseMirrorView",_f,Be,yi),N(te,4,"_tool",jf,Be,hi),N(te,4,"validationWarning",Hf,Be,Ii),N(te,2,"editorClipGeometryEntry",Wf,Be),N(te,2,"editorOverlayClipPath",zf,Be),se(te,Be);var Yf,$f,Rt,Ui,wi;$f=[k()],Yf=[k()];var kt=class{constructor(o,e,t){this.scheduler=o;this.routeStore=e;this.undoRedoManager=t;h(this,"layoutCache",new Is);h(this,"sandboxCollectionData",new Us("editor"));h(this,"sandboxVisibility",new ws("editor"));R(this,Ui,C(Rt,8,this,wa.createWithRouteSegmentRoot())),C(Rt,11,this);R(this,wi,C(Rt,12,this,0)),C(Rt,15,this);h(this,"timeline",new xs(this.tree));h(this,"treeIndexes",new Ci(this))}get tree(){return this._tree}get domLayoutUpdate(){return this._domLayoutUpdate}get remoteTreeVersion(){return this.timeline.remoteTreeVersion}getChangesForUndo(){let o=this.timeline.getLatestChangesForUndo();return o?o.filter(e=>!e.ignoreInUndo):[]}hasChanged(){return this.undoRedoManager.getUndoBufferSize()>0}getPartialIndexes(){return this.treeIndexes}getLoadedIndexes(){let o=this.tree.getService("loader");if(o){let e=o.numberOfScopesToLoad();throw new Error(`Some scopes are still loading: ${e} scopes left to load`)}return this.treeIndexes}onLayoutMeasure(o){let e=this.layoutCache.processLayoutMeasurements(o);e.size===0||Ja(this.tree,this.layoutCache,e).size===0||this._domLayoutUpdate++}onSandboxRendered(o){let e=new Set;if(o.collectionUpdates){let t=this.sandboxCollectionData.import(o.collectionUpdates);for(let n of t){let i=Pt(n);e.add(i)}}if(o.visibilityUpdates){let t=this.sandboxVisibility.import(o.visibilityUpdates);for(let n of t){let i=Pt(n);e.add(i)}}if(e.size>0){let t=Fs(this.tree,e);Zo(this.tree,this.layoutCache,this.sandboxCollectionData,this.sandboxVisibility,S.activeBundleHash,this.routeStore.localeId,void 0,t)}o.layoutMeasurements&&this.onLayoutMeasure(o.layoutMeasurements)}newTreeAfterRemoteUpdate(o){o.inEditor=!0,this._tree!==o&&(this._tree=o)}newTreeAfterLocalUpdate(o,e){if(o.inEditor=!0,this._tree===o)return;this._tree=o;let t=this.getChangesForUndo();e&&t.length>0&&this.undoRedoManager.addUndoEntry({changes:t})}};Rt=ae(null),Ui=new WeakMap,wi=new WeakMap,N(Rt,4,"_tree",$f,kt,Ui),N(Rt,4,"_domLayoutUpdate",Yf,kt,wi),se(Rt,kt);var Ci=class{constructor(o){this.treeStore=o;h(this,"codeComponentNodeCache");h(this,"richTextNodeCache")}get codeComponents(){let o=this.treeStore.tree;if(this.codeComponentNodeCache?.tree===o)return this.codeComponentNodeCache.codeComponentNodes;let e=[];for(let t of o.root.walk())ke(t)&&e.push(t);return this.codeComponentNodeCache={tree:o,codeComponentNodes:e},e}get richTextNodes(){let o=this.treeStore.tree;if(this.richTextNodeCache?.tree===o)return this.richTextNodeCache.richTextNodes;let e=[];for(let t of o.root.walk())A(t)&&e.push(t);return this.richTextNodeCache={tree:o,richTextNodes:e},e}};var Yr=class extends Ts{};var $r=class{constructor(o,e,t){h(this,"accessStore");h(this,"assetStore");h(this,"canvasStore");h(this,"componentsStore");h(this,"contextMenuStore");h(this,"editableNodeHighlightStore");h(this,"hostnameStore");h(this,"loadedExternalModulesStore");h(this,"loginStore");h(this,"modalStore");h(this,"modulesStore");h(this,"mouseStore");h(this,"persistedUserDefaults");h(this,"projectStore");h(this,"routeStore");h(this,"sandboxStore");h(this,"scopeStore");h(this,"toolStore");h(this,"treeStore");h(this,"undoRedoManager",new Yr);h(this,"vectorsStore");this.assetStore=new Bt(e),this.editableNodeHighlightStore=new so(e),this.routeStore=new It(e,()=>o.onChangeRoute()),this.componentsStore=new zr,this.contextMenuStore=vs.new(e),this.hostnameStore=Hr.new(e),this.modalStore=Ca.new(e),this.treeStore=new kt(e,this.routeStore,this.undoRedoManager),this.projectStore=Kr.new(e,this.assetStore,this.treeStore),this.accessStore=Lr.new(e,this.projectStore,this.hostnameStore,t),this.loginStore=_r.new(e,this.accessStore),this.mouseStore=new be(e),this.canvasStore=new ct(e,this.accessStore,this.routeStore,this.treeStore,this.projectStore,this.modalStore,this.undoRedoManager,()=>o.exitTool(),()=>o.onChangeRoute()),this.toolStore=new Be(e,this.treeStore,this.routeStore,this.canvasStore,this.mouseStore),this.scopeStore=new co(e,this.routeStore,this.treeStore),this.sandboxStore=Gr.new(e,this.componentsStore,this.treeStore,o.performanceTracker,o.sandboxUpdateGenerator),this.loadedExternalModulesStore=jr.new(e,this.sandboxStore),this.modulesStore=gs.new(e,this.treeStore,this.loadedExternalModulesStore,{codeEditorPreviewVisible:!1,mainView:0},this.projectStore.getProject().then(n=>n.modulesAPI),()=>{throw new Error("Can't make document readonly")},async n=>{await(await this.sandboxStore.getModulesRuntime()).insertTemporaryImportMap(n)},async()=>{throw new Error("Can't load all local modules")}),this.persistedUserDefaults=qr.new(e),this.vectorsStore=Ns.new(e,this.modulesStore)}};var Xr=class{constructor(){h(this,"editorBarReadyAt");h(this,"canvasReadyAt");h(this,"canvasLoaderViewedAt")}get editorBarReadyMs(){let o=tp();if(!(Te(o)||Te(this.editorBarReadyAt)))return this.editorBarReadyAt-o}get canvasReadyMs(){if(!(Te(this.canvasReadyAt)||Te(this.editorBarReadyAt)))return this.canvasReadyAt-this.editorBarReadyAt}get perceivedCanvasLoadMs(){if(!Te(this.canvasReadyAt))return Te(this.canvasLoaderViewedAt)?0:Math.min(this.canvasReadyAt-this.canvasLoaderViewedAt,0)}reportEditorBarReady(){this.editorBarReadyAt=Date.now()}reportCanvasLoaderViewed(){this.canvasLoaderViewedAt=Date.now()}reportCanvasReady(){this.canvasReadyAt=Date.now(),this.sendCanvasLoadedEvent()}sendCanvasLoadedEvent(){let{canvasReadyMs:o,editorBarReadyMs:e,perceivedCanvasLoadMs:t}=this;Te(o)||Te(e)||Te(t)||Me("editor_bar_canvas_loaded",{editorBarReadyMs:e,canvasReadyMs:o,perceivedCanvasLoadMs:t})}};function tp(){let r=new URLSearchParams(window.location.search).get("loadStart");if(!r)return;let o=Number(r);if(!Number.isNaN(o))return o}var Zr=class{constructor(o){this.engine=o;h(this,"partialTreeSender");h(this,"previousWebPageNodeId");h(this,"previousCollectionItemNodeId");h(this,"previousBreakpointNodeId");h(this,"previousTemporaryCollectionItemNodeId");h(this,"previousStylePresetBreakpointClassNames");h(this,"previousLocalModules");h(this,"previousDependenciesModule");h(this,"previousAssets");h(this,"previousNodeInTextEditor");h(this,"previousNodeInTextEditorClipPath");h(this,"previousMoveToolState");h(this,"previousLocaleId")}getUpdate(){let{canvasStore:o,modulesStore:e,routeStore:t,assetStore:n,treeStore:i,toolStore:a}=this.engine.stores,s={},l=at({tree:i.tree,webPageNodeId:t.webPageNodeId})?.id;l!==this.previousWebPageNodeId&&(this.previousWebPageNodeId=l,s.webPageNodeId=l);let d=Ze(t,i,o)?.id;d!==this.previousCollectionItemNodeId&&(this.previousCollectionItemNodeId=d,s.collectionItemNodeId=d);let u=ye({screenWidth:o.screenWidth,tree:i.tree,webPageNodeId:t.webPageNodeId})?.id;u!==this.previousBreakpointNodeId&&(this.previousBreakpointNodeId=u,s.breakpointNodeId=u);let g=o.temporaryCollectionItemNodeId??null;g!==this.previousTemporaryCollectionItemNodeId&&(this.previousTemporaryCollectionItemNodeId=g,s.temporaryCollectionItemNodeId=g);let U=i.tree.getPresetsListNode(),c=op(U,o.screenWidth);c!==this.previousStylePresetBreakpointClassNames&&(this.previousStylePresetBreakpointClassNames=c,s.stylePresetBreakpointClassNames=c);let f=e.localModules;f!==this.previousLocalModules&&(this.previousLocalModules=f,s.localModules=new Map(f));let w=e.dependenciesModule;w!==this.previousDependenciesModule&&(this.previousDependenciesModule=w,s.dependenciesModule=w);let p=n.assets;p!==this.previousAssets&&(this.previousAssets=p,s.assets=p),this.partialTreeSender??=new dl(i.timeline,"canvas");let P=this.partialTreeSender.update(l);Ao(P)||(s.partialTreeUpdate=P);let b=a.nodeInTextEditorId??null;b!==this.previousNodeInTextEditor&&(this.previousNodeInTextEditor=b,s.nodeInTextEditorId=b);let v=a.sandboxNodeInTextEditorClipPath??null;v!==this.previousNodeInTextEditorClipPath&&(this.previousNodeInTextEditorClipPath=v,s.nodeInTextEditorClipPath=v);let D=a.tool instanceof he?a.tool.state:void 0;return ge(D,this.previousMoveToolState)||(this.previousMoveToolState=D,s.moveToolState=D??null),t.localeId!==this.previousLocaleId&&(this.previousLocaleId=t.localeId,s.activeLocaleId=t.localeId),s}},op=Vi((r,o)=>{let e=fl(r);return ml(e,o)});var Jr=class{constructor(o){this.siteId=o;h(this,"name","OnPageEngine");h(this,"sandboxUpdateGenerator",new Zr(this));h(this,"performanceTracker",new Xr);h(this,"scheduler",new Vr(this));h(this,"stores");this.stores=new $r(this,this.scheduler,o),this.stores.projectStore.getProject().then(e=>{m(this.stores.assetStore.assetService,"assetsService must be initialized"),ys(this,this.stores.assetStore.assetService,this.stores.projectStore.filePickerRef),os(e.api,this.stores.assetStore.assetService),this.stores.modulesStore.initialize().catch(de),e.connection.on("connect",t=>{t&&this.stores.modulesStore.refresh().catch(de)})})}get tree(){return this.stores.treeStore.tree}startHighlightTool(){this.stores.toolStore.tool=new Le(this)}startComponentInstanceEditTool(o,e){this.stores.toolStore.tool=new je(this,o,e)}startDateVariableEditTool(o,e,t){this.stores.toolStore.tool=new _e(this,o,e,t)}startCollectionReferenceVariableEditTool(o,e,t){this.stores.toolStore.tool=new He(this,o,e,t)}startEnumVariableEditTool(o,e,t){this.stores.toolStore.tool=new qe(this,o,e,t)}startImageEditTool(o,e){this.stores.toolStore.tool=new Ke(this,o,e)}startRichTextEditTool(o,e,t){this.stores.toolStore.tool=new we(this,o,e,t)}startRichTextVariableEditTool(o,e,t){this.stores.toolStore.tool=new Fe(this,o,e,t)}startStringVariableEditTool(o,e,t){this.stores.toolStore.tool=new Ve(this,o,e,t)}startMoveTool(o,e,t){this.stores.toolStore.tool=new he(this,o,e,t)}exitTool(){this.startHighlightTool()}onChangeRoute(){this.stores.editableNodeHighlightStore.onChangeRoute(),this.exitTool()}getStateToken(){return this.stores.undoRedoManager.getUndoBufferSize()}undo(){let{undoRedoManager:o,toolStore:e,projectStore:t}=this.stores;e.tool?.undo?e.tool.undo():o.peekUndo()&&(o.undo(this.tree),t.commitTreeAndSend(!1))}redo(){let{undoRedoManager:o,toolStore:e,projectStore:t}=this.stores;e.tool?.redo?e.tool.redo():o.peekRedo()&&(o.redo(this.tree),t.commitTreeAndSend(!1))}beginUndoGroup(){this.stores.undoRedoManager.beginUndoGroup()}endUndoGroup(){this.stores.undoRedoManager.scheduleEndUndoGroup()}};var wt=y(I());Oi({enableFontStore:!0,fetchGoogleFontsList:ks,fetchFontshareFontsList:Rs,fetchBuiltInFontsList:Ds});async function MS(r,o){let e=new Jr(o);await e.stores.accessStore.set(r),e.stores.sandboxStore.loadSandbox(),Ps(e.stores.assetStore.assetMap),ft.importFramerFonts(Xi),us(),Object.assign(window,{engine:e,componentLoader:S}),Bs((0,wt.jsx)(ta.Provider,{value:e,children:(0,wt.jsx)(Zs,{forceDarkMode:!0,children:(0,wt.jsx)(Ma,{mode:"onPageEditing",children:(0,wt.jsxs)(Gl,{children:[(0,wt.jsx)(cf,{}),(0,wt.jsx)(ff,{})]})})})}),document.getElementById("root"))}export{MS as renderEditorBar};
//# sourceMappingURL=https://app.framerstatic.com/render-ALHZ7NY2.mjs.map
